{
  "version": 3,
  "sources": ["../src/ajax.ts", "../src/elements.ts", "../src/animate.ts", "../src/browser.ts", "../src/eval.ts", "../src/events.ts", "../src/observable.ts", "../src/svg.ts", "../src/audio.ts", "../src/confetti.ts", "../src/draggable.ts", "../src/router.ts", "../src/thread.ts", "../src/webcomponents.ts"],
  "sourcesContent": ["// =============================================================================\n// Boost.js | AJAX Functions\n// (c) Mathigon\n// =============================================================================\n\n\nimport {cache, deepExtend, Obj, throttle, unique} from '@mathigon/core';\nimport {$N} from './elements';\n\n\n// -----------------------------------------------------------------------------\n// Helper functions\n\ndeclare global {\n  interface Window {\n    csrfToken: string;\n  }\n}\n\ntype PostData = Obj<string|number|boolean|string[]|number[]|boolean[]>;\n\n/** Converts a JSON object to an HTML query string. */\nexport function toQueryString(data: PostData) {\n  const pairs: string[] = [];\n\n  for (let key of Object.keys(data)) {\n    let value = data[key];\n    key = encodeURIComponent(key);\n    // eslint-disable-next-line eqeqeq\n    if (value == undefined) {\n      pairs.push(key);\n      continue;\n    }\n    value = Array.isArray(value) ? value.join(',') : `${value}`;\n    value = value.replace(/(\\r)?\\n/g, '\\r\\n');\n    value = encodeURIComponent(value);\n    value = value.replace(/%20/g, '+');\n    pairs.push(`${key}=${value}`);\n  }\n\n  return pairs.join('&');\n}\n\n\n/** Converts an HTML query string to JSON object. */\nexport function fromQueryString(str: string) {\n  str = str.replace(/^[?,&]/, '');\n  const pairs = decodeURIComponent(str).split('&');\n  const result: Obj<string> = {};\n  pairs.forEach((pair) => {\n    const x = pair.split('=');\n    result[x[0]] = x[1];\n  });\n  return result;\n}\n\n\n// -----------------------------------------------------------------------------\n// Request Utilities\n\n/**\n * Asynchronously loads a resource using a POST request. This utility function\n * automatically form-encodes JSON data and adds a CSRF header.\n */\nexport async function post(url: string, data?: FormData|PostData) {\n  const isForm = data instanceof FormData;\n\n  const options = {\n    method: 'POST',\n    body: isForm ? (data as FormData) : data ? toQueryString(data) : undefined,\n    headers: {'X-CSRF-Token': window.csrfToken || ''} as Record<string, string>\n  };\n\n  if (!isForm) options.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n\n  const ext = url.includes('?') ? '&xhr=1' : '?xhr=1';\n  const response = await fetch(url + ext, options);\n  if (!response.ok) throw new Error(`Fetch error ${response.status}: ${url}`);\n  return response.text();\n}\n\n/** Asynchronously loads and executes a JS script. */\nexport function loadScript(src: string) {\n  return new Promise((resolve, reject) => {\n    const el = document.createElement('script');\n    el.src = src;\n    el.onerror = reject;\n    el.onload = resolve;\n    document.head.appendChild(el);  // TODO Needs document!\n  });\n}\n\n/** Asynchronously loads an Image. */\nexport function loadImage(url: string, credentials = false): Promise<HTMLImageElement> {\n  return new Promise((resolve) => {\n    const img = new Image();\n    if (!credentials) img.crossOrigin = 'Anonymous';\n    img.onload = () => resolve(img);\n    img.src = url;\n  });\n}\n\nexport const loadImageDataURI = cache(async (url: string) => {\n  const img = await loadImage(url);\n  const $canvas = $N('canvas', {width: img.width, height: img.height});\n  $canvas.ctx.drawImage(img, 0, 0, img.width, img.height);\n  return $canvas.image('png');\n});\n\n\n// -----------------------------------------------------------------------------\n// Deferred Post\n\nconst POST_DATA = new Map<string, PostData>();\n\nfunction savePostData(url: string, data: PostData) {\n  if (POST_DATA.has(url)) {\n    deepExtend(POST_DATA.get(url)!, data, (a, b) => unique(a.concat(b)));\n  } else {\n    POST_DATA.set(url, data);\n  }\n}\n\nfunction sendPostData() {\n  if (!window.navigator.onLine) return;\n\n  for (const [url, data] of POST_DATA) {\n    // Remove the POST data immediately, but add it back if the request fails.\n    // This means that deferredPost() can be called while an AJAX request is\n    // in progress, and the data is not lost.\n    POST_DATA.delete(url);\n    post(url, {data: JSON.stringify(data)})\n      .catch((error) => {\n        console.error('Failed to send POST request:', error);\n        savePostData(url, data);\n      });\n  }\n}\n\nconst doDeferredPost = throttle(sendPostData, 5000);\nwindow.addEventListener('online', doDeferredPost);\nwindow.onbeforeunload = sendPostData;\n\n/**\n * Utility function to throttle repeated POST requests. A request to the same\n * URL will be made at most every 5s, and the corresponding data objects will\n * be deep-merged.\n */\nexport function deferredPost(url: string, data: PostData) {\n  savePostData(url, data);\n  doDeferredPost();\n}\n", "// =============================================================================\n// Boost.js | Element Classes\n// (c) Mathigon\n// =============================================================================\n\n\nimport {isOneOf, Obj, words} from '@mathigon/core';\nimport {TransformMatrix} from '@mathigon/euclid/src';\nimport {clamp, isBetween, nearlyEquals, roundTo} from '@mathigon/fermat';\nimport {CanvasDrawingOptions, drawCanvas, drawSVG, GeoElement, GeoShape, Point, Rectangle, SimplePoint, SVGDrawingOptions} from '@mathigon/euclid';\nimport {loadImage, loadImageDataURI} from './ajax';\n\nimport {animate, AnimationProperties, AnimationResponse, ease, enter, exit, transition} from './animate';\nimport {Browser, keyCode} from './browser';\nimport {compile, compileString} from './eval';\nimport {bindEvent, EventCallback, unbindEvent} from './events';\nimport {Observable, observe} from './observable';\nimport {cleanSVG, copySVGStyles, parsePath} from './svg';\n\nimport type {Modal} from './components/modal';\nimport type {Alert} from './components/alert';\nimport type {IconView} from './components/icon';\nimport type {Popup} from './components/popup';\nimport type {Select} from './components/select';\n\n\ndeclare global {\n  interface Element {\n    _view?: ElementView;\n  }\n}\n\n// Override Typescript defaults\ninterface EventListenerOptions {\n  capture?: boolean;\n  passive?: boolean;\n}\n\n\n// -----------------------------------------------------------------------------\n// Base Element Class\n\nexport abstract class BaseView<T extends HTMLElement|SVGElement> {\n  readonly _data: Obj<unknown> = {};\n  readonly _events: Obj<EventCallback[]> = {};\n  readonly type: string = 'default';\n  model?: Observable;\n\n  constructor(readonly _el: T) {\n    // Store a reference to this element within the native browser DOM.\n    _el._view = this;\n  }\n\n  get id() {\n    return this._el.id;\n  }\n\n  get data() {\n    return this._el.dataset;\n  }\n\n  get tagName() {\n    return this._el.tagName.toUpperCase();\n  }\n\n  equals(el: ElementView) {\n    return this._el === el._el;\n  }\n\n  /** Adds one or more space-separated classes to this element. */\n  addClass(className: string) {\n    for (const c of words(className)) this._el.classList.add(c);\n  }\n\n  removeClass(className: string) {\n    for (const c of words(className)) this._el.classList.remove(c);\n  }\n\n  hasClass(className: string) {\n    return this._el.classList.contains(className);\n  }\n\n  toggleClass(className: string) {\n    return this._el.classList.toggle(className);\n  }\n\n  /** Toggles multiple space-separated class names based on a condition. */\n  setClass(className: string, condition: boolean) {\n    if (condition) {\n      this.addClass(className);\n    } else {\n      this.removeClass(className);\n    }\n  }\n\n  attr(attr: string) {\n    return this._el.getAttribute(attr) || '';\n  }\n\n  hasAttr(attr: string) {\n    return this._el.hasAttribute(attr);\n  }\n\n  setAttr(attr: string, value: unknown) {\n    if (value === undefined) {\n      this.removeAttr(attr);\n    } else {\n      this._el.setAttribute(attr, `${value}`);\n    }\n  }\n\n  removeAttr(attr: string) {\n    this._el.removeAttribute(attr);\n  }\n\n  get attributes() {\n    // Array.from() converts the NamedNodeMap into an array (for Safari).\n    return Array.from(this._el.attributes || []);\n  }\n\n  get html() {\n    return this._el.innerHTML || '';\n  }\n\n  set html(h: string) {\n    this._el.innerHTML = h;\n  }\n\n  get text(): string {\n    return this._el.textContent || '';\n  }\n\n  set text(t: string) {\n    this._el.textContent = t;\n  }\n\n  // Required because TS doesn't allow getters and setters with different types.\n  set textStr(t: unknown) {\n    this._el.textContent = `${t}`;\n  }\n\n  /** Blurs this DOM element. */\n  blur() {\n    this._el.blur();\n  }\n\n  /** Focuses this DOM element. */\n  focus() {\n    this._el.focus();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Templates and Model Binding\n\n  getParentModel(): Observable|undefined {\n    const parent = this.parent;\n    return parent ? (parent.model || parent.getParentModel()) : undefined;\n  }\n\n  bindModel(model: Observable, recursive = true) {\n    if (this.model) return;  // Prevent duplicate binding.\n    this.model = model;\n\n    // Special handling for :for attributes needs to happen first\n    if (this.hasAttr(':for')) return this.makeDynamicList(model);\n\n    for (const {name, value} of this.attributes) {\n      this.makeDynamicAttribute(name, value, model);\n    }\n\n    for (const $c of this.childNodes) {\n      if ($c instanceof Text) {\n        if ($c.textContent?.includes('${')) {\n          const expr = compileString($c.textContent);\n          model.watch(() => ($c.textContent = expr(model) || ''));\n        }\n      } else if (recursive) {\n        $c.bindModel(model);\n      }\n    }\n  }\n\n  bindVariable(_model: Observable, _name: string) {\n    // Can be implemented by child classes.\n  }\n\n  private $placeholder?: ElementView;\n\n  /** Conditionally hide this element from the DOM (using placeholder comments). */\n  toggleDOM(show = true) {\n    if (show === !!this._el.parentNode) return;\n\n    if (!this.$placeholder) {\n      this.$placeholder = $(document.createComment('') as unknown as Element)!;\n      this.insertBefore(this.$placeholder);\n    }\n\n    if (show) {\n      this.$placeholder.insertBefore(this);\n    } else {\n      this.detach();\n    }\n  }\n\n  private makeDynamicAttribute(name: string, value: string, model: Observable) {\n    if (name.startsWith('@')) {\n      const event = name.slice(1);\n      const expr = compile(value);\n      this.on(event, (e) => expr(model, {$event: e}));\n\n    } else if (name === ':show') {\n      const expr = compile(value);\n      model.watch(() => this.toggle(!!expr(model)));\n\n    } else if (name === ':if') {\n      // While :show only toggles the visibility of an element, :if actually\n      // removes it from the DOM. This is useful for :first/last-child CSS.\n      const expr = compile(value);\n      model.watch(() => this.toggleDOM(!!expr(model)));\n\n    } else if (name === ':html') {\n      const expr = compile(value);\n      model.watch(() => (this.html = expr(model) || ''));\n\n    } else if (name === ':draw') {\n      const expr = compile(value);\n      model.watch(() => (this as unknown as SVGView).draw(expr(model)));\n\n    } else if (name ===':class') {\n      const expr = compile(value);\n      const initialClass = `${this.attr('class')} `;\n      model.watch(() => this.setAttr('class', initialClass + expr(model)));\n\n    } else if (name === ':bind') {\n      this.bindVariable(model, value);\n\n    } else if (name.startsWith(':')) {\n      const expr = compile(value);\n      const attr = name.slice(1);\n      model.watch(() => this.setAttr(attr, expr(model)));\n\n    } else if (value.includes('${')) {\n      const expr = compileString(value, true);\n      model.watch(() => this.setAttr(name, expr(model) || ''));\n    }\n\n    if (name.startsWith('@') || name.startsWith(':')) this.removeAttr(name);\n  }\n\n  private makeDynamicList(model: Observable) {\n    const [name, value] = this.attr(':for').split(' in ');\n    this.removeAttr(':for');\n\n    const expr = compile(value);\n    const $placeholder = $(document.createComment('') as unknown as Element)!;\n    this.insertBefore($placeholder);\n    this.detach();\n\n    const $cached: ElementView[] = [];\n    let visible = 0;\n\n    model.watch(() => {\n      // TODO Better diff checking for arrays\n      let array = expr(model);\n      if (!Array.isArray(array)) array = [];\n\n      // Hide or show existing elements\n      for (let i = array.length; i < visible; ++i) $cached[i].detach();\n      for (let i = visible; i < $cached.length; ++i) $placeholder.insertBefore($cached[i]);\n\n      // Create new elements if necessary\n      for (let i = $cached.length; i < array.length; ++i) {\n        const $el = this.copy(true);\n        // TODO Set the index name as \"local\" variable, not a separate model\n        $el.bindModel(observe({[name]: undefined}, model));\n        $placeholder.insertBefore($el);\n        $cached.push($el);\n      }\n      visible = array.length;\n\n      for (let i = 0; i < visible; ++i) $cached[i].model[name] = array[i];\n    });\n  }\n\n\n  // -------------------------------------------------------------------------\n  // Scrolling and Dimensions\n\n  get bounds() {\n    return this._el.getBoundingClientRect();\n  }\n\n  get boundsRect() {\n    const bounds = this.bounds;\n    return new Rectangle(new Point(bounds.x, bounds.y), bounds.width, bounds.height);\n  }\n\n  contains(point: Point) {\n    return this.boundsRect.contains(point);\n  }\n\n  /** Checks if this element is currently visible in the viewport. */\n  get isInViewport() {\n    if (this.height === 0) return false;\n    const bounds = this.bounds;\n    return isBetween(bounds.top, -bounds.height, Browser.height);\n  }\n\n  get topLeftPosition() {\n    const bounds = this.bounds;\n    return new Point(bounds.left, bounds.top);\n  }\n\n  get boxCenter() {\n    const box = this.bounds;\n    return new Point(box.left + box.width / 2, box.top + box.height / 2);\n  }\n\n  abstract get width(): number;\n\n  abstract get height(): number;\n\n  abstract get positionLeft(): number;\n\n  abstract get positionTop(): number;\n\n  get scrollWidth() {\n    return this._el.scrollWidth;\n  }\n\n  get scrollHeight() {\n    return this._el.scrollHeight;\n  }\n\n  get scrollTop() {\n    return this._el.scrollTop;\n  }\n\n  set scrollTop(y: number) {\n    this._el.scrollTop = y;\n    this.trigger('scroll', {top: y, left: this.scrollLeft});\n  }\n\n  get scrollLeft() {\n    return this._el.scrollLeft;\n  }\n\n  set scrollLeft(x: number) {\n    this._el.scrollLeft = x;\n    this.trigger('scroll', {top: this.scrollTop, left: x});\n  }\n\n  /** Scrolls the element to a specific position. */\n  scrollTo(pos: number, time = 1000, easing = 'cubic') {\n    if (pos < 0) pos = 0;\n    const startPosition = this.scrollTop;\n    const distance = pos - startPosition;\n\n    if (this._data.scrollAnimation) (this._data.scrollAnimation as Animation).cancel();\n    // TODO Also cancel animation after manual scroll events.\n\n    this._data.scrollAnimation = animate(t => {\n      const y = startPosition + distance * ease(easing, t);\n      this.scrollTop = y;\n      this.trigger('scroll', {top: y});\n    }, time);\n  }\n\n  /** Scrolls the element by a given distance. */\n  scrollBy(distance: number, time = 1000, easing = 'cubic') {\n    if (!distance) return;\n    this.scrollTo(this.scrollTop + distance, time, easing);\n  }\n\n\n  // -------------------------------------------------------------------------\n  // Styles\n\n  /**\n   * Retrieves or sets CSS properties on this element. Examples:\n   *   * $el.css('color');  // returns 'red'\n   *   * $el.css('color', 'blue');\n   *   * $el.css({color: 'blue'});\n   */\n  css(props: string|Obj<string|number>, value?: string|number) {\n    if (value === undefined) {\n      if (typeof props === 'string') {\n        return window.getComputedStyle(this._el).getPropertyValue(props);\n      } else {\n        const keys = Object.keys(props);\n        for (const p of keys) this._el.style.setProperty(p, `${props[p]}`);\n      }\n    } else if (typeof props === 'string') {\n      this._el.style.setProperty(props, `${value}`);\n    }\n  }\n\n  /** Shortcut for getting the CSS transform style of an element. */\n  get transform() {\n    return this.css('transform')!.replace('none', '');\n  }\n\n  get transformMatrix(): TransformMatrix {\n    const transform = this.transform;\n    if (!transform) return [[1, 0, 0], [0, 1, 0]];\n\n    const coords = transform.match(/matrix\\(([0-9,.\\s-]*)\\)/);\n    if (!coords || !coords[1]) return [[1, 0, 0], [0, 1, 0]];\n\n    const matrix = coords[1].split(',');\n    return [[+matrix[0], +matrix[2], +matrix[4]],\n      [+matrix[1], +matrix[3], +matrix[5]]];\n  }\n\n  /** Finds the x and y scale of this element. */\n  get scale() {\n    const matrix = this.transformMatrix;\n    return [matrix[0][0], matrix[1][1]];\n  }\n\n  /** Sets the CSS transform on this element. */\n  setTransform(posn?: SimplePoint, angle = 0, scale = 1) {\n    let t = '';\n    if (posn) t += `translate(${roundTo(posn.x, 0.1)}px,${roundTo(posn.y, 0.1)}px)`;\n    if (angle) t += ` rotate(${angle}rad)`;\n    if (scale) t += ` scale(${scale})`;\n    this._el.style.transform = t;\n  }\n\n  /** Sets the CSS transform of this element to an x/y translation. */\n  translate(x: number, y: number) {\n    this.setTransform(new Point(x, y));\n  }\n\n  /**\n   * Makes the element visible. Use the `data-display` attribute to determine\n   * how this is done. Possible options are `visibility`, to use CSS visibility,\n   * or CSS display values. The default is `display: block`.\n   */\n  show() {\n    if (this.hasAttr('hidden')) this.removeAttr('hidden');\n\n    if (this.data['display'] === 'visibility') {\n      this._el.style.visibility = 'visible';\n    } else {\n      this._el.style.display = this.data.display || 'block';\n    }\n  }\n\n  /**\n   * Makes the element invisible, using CSS visibility (if\n   * `data-display=\"visibility\"`), or `display: none`.\n   */\n  hide() {\n    if (this.data['display'] === 'visibility') {\n      this._el.style.visibility = 'hidden';\n    } else {\n      this._el.style.display = 'none';\n    }\n  }\n\n  /** Hides or shows the element based on a boolean value. */\n  toggle(show?: boolean) {\n    if (show) {\n      this.show();\n    } else {\n      this.hide();\n    }\n  }\n\n\n  // -------------------------------------------------------------------------\n  // DOM Manipulation\n\n  /** Checks if an element matches a given CSS selector. */\n  is(selector: string) {\n    if (this._el.matches) return this._el.matches(selector);\n    return Array.from(document.querySelectorAll(selector)).includes(this._el);\n  }\n\n  /** Finds the index of an elements, in the list of its siblings. */\n  index() {\n    let i = 0;\n    let child: Node|undefined = this._el;\n    while ((child = (child.previousSibling ||undefined)) !== undefined) ++i;\n    return i;\n  }\n\n  /** Adds a new child element at the beginning of this one. */\n  prepend(newChild: ElementView) {\n    const children = this._el.childNodes;\n    if (children.length) {\n      this._el.insertBefore(newChild._el, children[0]);\n    } else {\n      this._el.appendChild(newChild._el);\n    }\n  }\n\n  /** Adds a new child element at the end of this one. */\n  append(newChild: ElementView|Text) {\n    this._el.appendChild(newChild instanceof Text ? newChild : newChild._el);\n  }\n\n  /** Adds a new element immediately before this one, as a sibling. */\n  insertBefore(newChild: ElementView) {\n    this.parent!._el.insertBefore(newChild._el, this._el);\n  }\n\n  /** Adds a new element immediately after this one, as a sibling. */\n  insertAfter(newChild: ElementView) {\n    const next = this._el.nextSibling;\n    if (next) {\n      this.parent!._el.insertBefore(newChild._el, next);\n    } else {\n      this.parent!._el.appendChild(newChild._el);\n    }\n  }\n\n  /** Returns this element's next sibling, or undefined. */\n  get next() {\n    return $(this._el.nextSibling as Element|undefined);\n  }\n\n  /** Returns this element's previous sibling, or undefined. */\n  get prev() {\n    return $(this._el.previousSibling as Element|undefined);\n  }\n\n  /** The first child element matching a given selector. */\n  $<T extends Element | string>(selector: T): QueryResult<T> {\n    return $(selector, this);\n  }\n\n  /** All child elements matching a given selector. */\n  $$<T extends string>(selector: T): QueryResults<T> {\n    return $$(selector, this);\n  }\n\n  /** Returns this element's parent, or undefined. */\n  get parent() {\n    // Note: parentNode breaks on document.matches.\n    return $(this._el.parentElement || undefined);\n  }\n\n  /** Finds all parent elements that match a specific selector. */\n  parents(selector: string) {\n    const result = [];\n    let parent = this.parent;\n    while (parent) {\n      if (!selector || parent.is(selector)) result.push(parent);\n      parent = parent.parent;\n    }\n    return result;\n  }\n\n  /** Checks if this element has one of the given elements as parent. */\n  hasParent(...$p: ElementView[]) {\n    const tests = $p.map(p => p._el);\n    let parent = this._el.parentNode;\n    while (parent) {\n      if (isOneOf(parent, ...tests)) return true;\n      parent = parent.parentNode;\n    }\n    return false;\n  }\n\n  /** Returns an array of all children of this element. */\n  get children() {\n    return Array.from(this._el.children || [], n => $(n)!);\n  }\n\n  /** Returns an array of all child nodes, including text nodes. */\n  get childNodes(): Array<ElementView|Text> {\n    return Array.from(this._el.childNodes, (node) => {\n      if (node instanceof Comment) return undefined;\n      if (node instanceof Text) return node;\n      return $(node as Element)!;\n    }).filter(x => x) as Array<ElementView|Text>;\n  }\n\n  /** Detach and re-insert to restart CSS animations. */\n  restartAnimation() {\n    const n = this.next;\n    const p = this.parent;\n    this.detach();\n    n ? n.insertBefore(this) : p!.append(this);\n  }\n\n  /** Detaches an element from the DOM. */\n  detach() {\n    if (this._el && this._el.parentNode) {\n      this._el.parentNode.removeChild(this._el);\n    }\n  }\n\n  /** Removes this element. */\n  remove() {\n    this.detach();\n    // TODO Remove event listeners (including children)\n    // TODO Remove model bindings (including children)\n    // this._el = this._data = this._events = undefined;\n  }\n\n  /** Removes all children of this element. */\n  removeChildren() {\n    while (this._el.firstChild) this._el.removeChild(this._el.firstChild);\n  }\n\n  /** Creates a copy of this element, and optionally its children. */\n  copy(recursive = true) {\n    return $(this._el.cloneNode(recursive) as Element)!;\n  }\n\n\n  // -------------------------------------------------------------------------\n  // Events\n\n  /** Binds one ore more space-separated event listeners on this element. */\n  on(events: string, callback: EventCallback, options?: EventListenerOptions) {\n    // TODO Use WeakRef to avoid having to unbind events when the element is deleted.\n    // https://v8.dev/features/weak-references\n    for (const e of words(events)) {\n      if (e in this._events) {\n        if (!this._events[e].includes(callback)) this._events[e].push(callback);\n      } else {\n        this._events[e] = [callback];\n      }\n      bindEvent(this, e, callback, options);\n    }\n  }\n\n  /** Binds a one-time event listener on this element. */\n  one(events: string, callback: EventCallback, options?: EventListenerOptions) {\n    const callbackWrap = (e: unknown) => {\n      this.off(events, callbackWrap);\n      callback(e);\n    };\n    this.on(events, callbackWrap, options);\n  }\n\n  /**\n   * Removes an event listener on this element. If callback is undefined, it\n   * removes all event listeners for this event.\n   */\n  off(events: string, callback?: EventCallback) {\n    for (const e of words(events)) {\n      if (e in this._events) {\n        this._events[e] = callback ? this._events[e].filter(fn => fn !== callback) : [];\n      }\n      unbindEvent(this, e, callback);\n    }\n  }\n\n  /** Triggers a specific event on this element. */\n  trigger(events: string, args: unknown = {}) {\n    for (const e of words(events)) {\n      if (!this._events[e]) return;\n      for (const fn of this._events[e]) fn.call(this, args);\n    }\n  }\n\n  /**\n   * Binds an event listener for a specific key that is pressed while this\n   * element is in focus.\n   */\n  onKey(keys: string, callback: (e: KeyboardEvent, key: string) => void, options?: {meta?: boolean, up?: boolean}) {\n    keys = keys.replace('AllArrows', 'ArrowUp ArrowDown ArrowLeft ArrowRight');\n    const keyNames = new Set(words(keys));\n    const event = options?.up ? 'keyup' : 'keydown';\n\n    const target = (this._el === document.body ? document : this._el) as HTMLElement;\n    target.addEventListener(event, (e: KeyboardEvent) => {\n      const key = keyCode(e);\n      if (options?.meta ? !e.ctrlKey && !e.metaKey : e.ctrlKey || e.metaKey) return;\n      if (!key || !keyNames.has(key)) return;\n      if (document.activeElement !== this._el && document.activeElement?.shadowRoot?.activeElement !== this._el && Browser.formIsActive) return;\n      callback(e as KeyboardEvent, key);\n    });\n  }\n\n  onAttr(name: string, callback: (value: string, initial?: boolean) => void) {\n    // TODO Reuse existing observers, remove events, disconnect when deleting.\n\n    const observer = new MutationObserver((mutations) => {\n      for (const m of mutations) {\n        if (m.type === 'attributes' && m.attributeName === name) {\n          callback(this.attr(name));\n        }\n      }\n    });\n\n    observer.observe(this._el, {attributes: true});\n    callback(this.attr(name), true);\n  }\n\n  /** Returns a promise that is resolved when an event is triggered. */\n  onPromise(event: string, resolveImmediately = false) {\n    if (resolveImmediately) return Promise.resolve();\n    return new Promise<void>((resolve) => this.one(event, () => resolve()));\n  }\n\n\n  // -------------------------------------------------------------------------\n  // Animations\n\n  /**\n   * Animates multiple CSS properties of this element, with a given duration,\n   * delay and ease function.\n   */\n  animate(rules: AnimationProperties, duration = 400, delay = 0,\n    easing = 'ease-in-out'): AnimationResponse {\n    return transition(this, rules, duration, delay, easing);\n  }\n\n  /**\n   * Runs an enter animation on this element. Valid effect names are\n   *   * 'fade', 'pop' and 'descend'\n   *   * 'draw' and 'draw-reverse'\n   *   * 'slide' and 'slide-down'\n   *   * 'reveal', 'reveal-left' and 'reveal-right'\n   */\n  enter(effect = 'fade', duration = 500, delay = 0): AnimationResponse {\n    return enter(this, effect, duration, delay);\n  }\n\n  /**\n   * Runs an exit animation on this element. See `.enter()` for options.\n   */\n  exit(effect = 'fade', duration = 500, delay = 0, remove = false): AnimationResponse {\n    return exit(this, effect, duration, delay, remove);\n  }\n\n  /**\n   * Triggers a CSS animation in an element by adding a class and removing it\n   * after the `animationEnd` event.\n   */\n  effect(className: string) {\n    this.one('animationend', () => this.removeClass(`effects-${className}`));\n    this.addClass(`effects-${className}`);\n  }\n}\n\nexport type ElementView = BaseView<HTMLElement|SVGElement>;\n\n\n// -----------------------------------------------------------------------------\n// HTML Elements\n\nexport class HTMLBaseView<T extends HTMLElement> extends BaseView<T> {\n\n  get offsetTop() {\n    return this._el.offsetTop;\n  }\n\n  get offsetLeft() {\n    return this._el.offsetLeft;\n  }\n\n  get offsetParent() {\n    return $(this._el.offsetParent || undefined);\n  }\n\n  /** Returns this element's width, including border and padding. */\n  get width() {\n    return this._el.offsetWidth;\n  }\n\n  /** Returns this element's height, including border and padding. */\n  get height() {\n    return this._el.offsetHeight;\n  }\n\n  /** Returns this element's width, excluding border and padding. */\n  get innerWidth() {\n    const left = parseFloat(this.css('padding-left')!);\n    const right = parseFloat(this.css('padding-right')!);\n    return this._el.clientWidth - left - right;\n  }\n\n  /** Returns this element's height, excluding border and padding. */\n  get innerHeight() {\n    const bottom = parseFloat(this.css('padding-bottom')!);\n    const top = parseFloat(this.css('padding-top')!);\n    return this._el.clientHeight - bottom - top;\n  }\n\n  /** Returns this element's width, including margins. */\n  get outerWidth() {\n    const left = parseFloat(this.css('margin-left')!);\n    const right = parseFloat(this.css('margin-right')!);\n    return (this.width + left + right) || 0;\n  }\n\n  /** Returns this element's height, including margins. */\n  get outerHeight() {\n    const bottom = parseFloat(this.css('margin-bottom')!);\n    const top = parseFloat(this.css('margin-top')!);\n    return (this.height + bottom + top) || 0;\n  }\n\n  /** @returns {number} */\n  get positionTop() {\n    let el: HTMLElement|undefined = this._el;\n    let offset = 0;\n\n    while (el) {\n      offset += el.offsetTop;\n      el = el.offsetParent as HTMLElement|undefined;\n    }\n\n    return offset;\n  }\n\n  /** @returns {number} */\n  get positionLeft() {\n    let el: HTMLElement|undefined = this._el;\n    let offset = 0;\n\n    while (el) {\n      offset += el.offsetLeft;\n      el = el.offsetParent as HTMLElement|undefined;\n    }\n\n    return offset;\n  }\n\n  /** Calculates the element offset relative to any other parent element. */\n  offset(parent: HTMLView) {\n    if (parent._el === this._el.offsetParent) {\n      // Get offset from immediate parent\n      const top = this.offsetTop + parent._el.clientTop;\n      const left = this.offsetLeft + parent._el.clientLeft;\n      const bottom = top + this.height;\n      const right = left + this.width;\n      return {top, left, bottom, right};\n\n    } else {\n      // Get offset based on any other element\n      const parentBox = parent._el.getBoundingClientRect();\n      const box = this._el.getBoundingClientRect();\n      return {\n        top: box.top - parentBox.top, left: box.left - parentBox.left,\n        bottom: box.bottom - parentBox.top, right: box.right - parentBox.left\n      };\n    }\n  }\n}\n\nexport type HTMLView = HTMLBaseView<HTMLElement>;\n\n\n// -----------------------------------------------------------------------------\n// SVG Elements\n\nexport class SVGBaseView<T extends SVGGraphicsElement> extends BaseView<T> {\n  readonly type = 'svg';\n\n  /** Returns the owner `<svg>` which this element is a child of. */\n  get $ownerSVG() {\n    return $(this._el.ownerSVGElement || undefined) as SVGParentView;\n  }\n\n  // See https://www.chromestatus.com/features/5724912467574784\n  get width() {\n    return this.bounds.width;\n  }\n\n  get height() {\n    return this.bounds.height;\n  }\n\n  // SVG Elements don't have offset properties. We instead use the position of\n  // the first non-SVG parent, plus the margin of the SVG owner, plus the SVG\n  // position of the individual element. This doesn't work for absolutely\n  // positioned SVG elements, and some other edge cases.\n\n  get positionLeft() {\n    const svgLeft = this._el.getBBox().x + this._el.getCTM()!.e;\n    return this.$ownerSVG.positionLeft + svgLeft;\n  }\n\n  get positionTop() {\n    const svgTop = this._el.getBBox().y + this._el.getCTM()!.f;\n    return this.$ownerSVG.positionTop + svgTop;\n  }\n\n  get inverseTransformMatrix() {\n    const m = this._el.getScreenCTM()!.inverse();\n    const matrix = [[m.a, m.c, m.e], [m.b, m.d, m.f]];\n\n    // Firefox doesn't account for the CSS transform of parent elements.\n    // TODO Use matrix product of all parent's transforms, not just the\n    // translation of the immediate parent.\n    if (Browser.isFirefox) {\n      const transform = this.transformMatrix;\n      matrix[0][2] -= transform[0][2];\n      matrix[1][2] -= transform[1][2];\n    }\n\n    return matrix as [[number, number, number], [number, number, number]];\n  }\n\n  setTransform(posn?: SimplePoint, angle = 0, scale = 1) {\n    // TODO Safari only supports transform-origin and transform-box for CSS\n    // transforms, not the [transform=] attribute:\n    // https://stackoverflow.com/questions/61272308/\n    const t1 = posn ? `translate(${roundTo(posn.x, 0.1)} ${roundTo(posn.y, 0.1)})` : '';\n    const t2 = nearlyEquals(angle, 0) ? '' : `rotate(${angle * 180 / Math.PI})`;\n    const t3 = nearlyEquals(scale, 1) ? '' : `scale(${scale})`;\n    this.setAttr('transform', [t1, t2, t3].join(' '));\n  }\n\n  /**\n   * Finds the total stroke length of this element. Similar to the SVG\n   * `getTotalLength()` function, but works for a wider variety of elements.\n   */\n  get strokeLength(): number {\n    if (this._el instanceof SVGGeometryElement) {\n      return this._el.getTotalLength();\n    } else {\n      const dim = this.bounds;\n      return 2 * dim.height + 2 * dim.width;\n    }\n  }\n\n  /**\n   * Gets the coordinates of the point at a distance `d` along the length of the\n   * stroke of this `<path>` element.\n   */\n  getPointAtLength(d: number) {\n    if (this._el instanceof SVGGeometryElement) {\n      const point = this._el.getPointAtLength(d);\n      return new Point(point.x, point.y);\n    } else {\n      return new Point(0, 0);\n    }\n  }\n\n  /**\n   * Gets the coordinates of the point at a position `p` along the length of the\n   * stroke of this `<path>` element, where `0 \u2264 p \u2264 1`.\n   */\n  getPointAt(p: number) {\n    return this.getPointAtLength(p * this.strokeLength);\n  }\n\n  /** Returns a list of all points along an SVG `<path>` element. */\n  get points() {\n    return parsePath(this.attr('d'));\n  }\n\n  /** Sets the list of points for an SVG `<path>` element.c*/\n  set points(p: SimplePoint[]) {\n    const d = p.length ? `M${p.map(x => `${x.x},${x.y}`).join('L')}` : '';\n    this.setAttr('d', d);\n  }\n\n  /** Appends a new point to an SVG `<path>` element. */\n  addPoint(p: SimplePoint) {\n    const d = `${this.attr('d')} L ${p.x},${p.y}`;\n    this.setAttr('d', d);\n  }\n\n  /** Finds the center of an SVG `<circle>` element. */\n  get center() {\n    const x = +this.attr(this.tagName === 'TEXT' ? 'x' : 'cx') || 0;\n    const y = +this.attr(this.tagName === 'TEXT' ? 'y' : 'cy') || 0;\n    return new Point(x, y);\n  }\n\n  /** Sets the center of an SVG `<circle>` or `<text>` element. */\n  setCenter(c: SimplePoint) {\n    this.setAttr(this.tagName === 'TEXT' ? 'x' : 'cx', c.x);\n    this.setAttr(this.tagName === 'TEXT' ? 'y' : 'cy', c.y);\n  }\n\n  /** Sets the end points of an SVG `<line>` element. */\n  setLine(p: SimplePoint, q: SimplePoint) {\n    this.setAttr('x1', p.x);\n    this.setAttr('y1', p.y);\n    this.setAttr('x2', q.x);\n    this.setAttr('y2', q.y);\n  }\n\n  /** Sets the bounds of an SVG `<rectangle>` element. */\n  setRect(rect: Rectangle) {\n    this.setAttr('x', rect.p.x);\n    this.setAttr('y', rect.p.y);\n    this.setAttr('width', rect.w);\n    this.setAttr('height', rect.h);\n  }\n\n  /** Draws a generic geometry object onto an SVG `<path>` element. */\n  draw(obj: GeoShape|undefined, options: SVGDrawingOptions = {}) {\n    if (!obj) return this.setAttr('d', '');\n    const attributes: SVGDrawingOptions = {};\n    for (const p of ['mark', 'arrows', 'round'] as const) {\n      if (this.hasAttr(p)) attributes[p] = this.attr(p) as any;\n    }\n    if (this.hasClass('fill')) attributes.fill = 'fill';\n    if (this.hasAttr('size')) attributes.size = (+this.attr('size')) || undefined;\n    this.setAttr('d', drawSVG(obj, Object.assign(options, attributes)));\n  }\n}\n\nexport class SVGParentView extends SVGBaseView<SVGSVGElement> {\n  /** Returns the viewport coordinates of this `<svg>` element. */\n  get viewBox() {\n    return (this._el as SVGSVGElement).viewBox.baseVal || {width: 0, height: 0};\n  }\n\n  get $ownerSVG() {\n    return this;\n  }\n\n  get positionLeft() {\n    return parseInt(this.css('margin-left')!) + this.parent!.positionLeft;\n  }\n\n  get positionTop() {\n    return parseInt(this.css('margin-top')!) + this.parent!.positionTop;\n  }\n\n  /** Returns the intrinsic width of this `<svg>` element. */\n  get svgWidth() {\n    return this.viewBox.width || this.width;\n  }\n\n  /** Returns the intrinsic height of this `<svg>` element. */\n  get svgHeight() {\n    return this.viewBox.height || this.height;\n  }\n\n  /** Create a new `<path>` element child and draw a geometry object onto it. */\n  drawPath(obj: GeoShape, attributes: Obj<unknown> = {}, options: SVGDrawingOptions = {}) {\n    const $el = $N('path', attributes, this) as SVGView;\n    $el.draw(obj, options);\n    return $el;\n  }\n\n  /** Converts an SVG element into a PNG, JPG or SVG data URI. */\n  async image(type: 'png'|'jpg'|'svg', width?: number, height?: number, viewBox?: string) {\n    const $copy = this.copy(true);\n    copySVGStyles(this._el, $copy._el);\n    if (type === 'svg') cleanSVG($copy._el);\n\n    if (!height) height = width || this.svgHeight;\n    if (!width) width = this.svgWidth;\n    $copy.setAttr('width', width);\n    $copy.setAttr('height', height);\n    $copy.setAttr('viewBox', viewBox || this.attr('viewBox') || `0 0 ${this.svgWidth} ${this.svgHeight}`);\n    $copy.setAttr('xmlns', 'http://www.w3.org/2000/svg');\n\n    const $images = $copy.$$('image');\n\n    if (type === 'svg') {\n      // Make all embedded URLs absolute.\n      for (const $i of $images) $i.setAttr('href', new URL($i.attr('href'), location.href));\n    } else {\n      // Convert all embedded images to data URIs, because of CORS issues.\n      await Promise.all($images.map(async $i => {\n        $i.setAttr('href', await loadImageDataURI($i.attr('href')));\n      }));\n    }\n\n    // TODO Load external fonts used in the SVG\n\n    const serialised = new XMLSerializer().serializeToString($copy._el);\n    const url = `data:image/svg+xml;utf8,${encodeURIComponent(serialised)}`;\n    if (type === 'svg') return url;\n\n    const $canvas = $N('canvas', {width, height}) as CanvasView;\n    if (type === 'jpg') {\n      $canvas.ctx.fillStyle = 'white';\n      $canvas.ctx.fillRect(0, 0, width, height);\n    }\n\n    const image = await loadImage(url);\n    $canvas.ctx.drawImage(image, 0, 0, width, height);\n    return $canvas.image(type);\n  }\n\n  downloadImage(fileName: string, width?: number, height?: number, viewBox?: string) {\n    // iOS Doesn't allow navigation calls within an async event.\n    const windowRef = Browser.isIOS ? window.open('', '_blank') : undefined;\n\n    const isDarkTheme = Browser.theme.isDark;\n    if (isDarkTheme) Browser.setTheme('light');\n    const type = fileName.endsWith('.jpg') ? 'jpg' : fileName.endsWith('.svg') ? 'svg' : 'png';\n    const dataUri = this.image(type, width, height, viewBox);\n    if (isDarkTheme) Browser.setTheme('dark');\n\n    dataUri.then((href) => {\n      if (windowRef) return (windowRef.location.href = href);\n      const $a = $N('a', {download: fileName, href, target: '_blank'});\n      $a._el.dispatchEvent(new MouseEvent('click',\n        {view: window, bubbles: false, cancelable: true}));\n    });\n  }\n}\n\nexport type SVGView = SVGBaseView<SVGGraphicsElement>;\n\n\n// -----------------------------------------------------------------------------\n// Window Element (<html> and <body>)\n\nexport class WindowView extends HTMLBaseView<HTMLHtmlElement|HTMLBodyElement> {\n  readonly type = 'window';\n\n  get width() {\n    return window.innerWidth;\n  }\n\n  get height() {\n    return window.innerHeight;\n  }\n\n  get innerWidth() {\n    return window.innerWidth;\n  }\n\n  get innerHeight() {\n    return window.innerHeight;\n  }\n\n  get outerWidth() {\n    return window.outerWidth;\n  }\n\n  get outerHeight() {\n    return window.outerHeight;\n  }\n\n  get scrollWidth() {\n    return document.body.scrollWidth;\n  }\n\n  get scrollHeight() {\n    return document.body.scrollHeight;\n  }\n\n  get scrollTop() {\n    return window.pageYOffset;\n  }\n\n  set scrollTop(y) {\n    document.body.scrollTop = document.documentElement.scrollTop = y;\n    this.trigger('scroll', {top: y, left: this.scrollLeft});\n  }\n\n  get scrollLeft() {\n    return window.pageXOffset;\n  }\n\n  set scrollLeft(x) {\n    document.body.scrollLeft = document.documentElement.scrollLeft = x;\n    this.trigger('scroll', {top: this.scrollTop, left: x});\n  }\n}\n\n\n// -----------------------------------------------------------------------------\n// Form Element (<form>, <input> and <select>)\n\ntype InputFieldElement = HTMLInputElement|HTMLSelectElement|HTMLTextAreaElement;\n\nexport class FormView extends HTMLBaseView<HTMLFormElement> {\n  readonly type = 'form';\n\n  get action() {\n    return this._el.action;\n  }\n\n  /** Summarises the data for an HTML <form> element in an JSON Object. */\n  get formData() {\n    const data: Obj<string> = {};\n    for (const el of Array.from(this._el.elements)) {\n      const id = (el as InputFieldElement).name || el.id;\n      if (id) data[id] = (el as InputFieldElement).value;\n    }\n    return data;\n  }\n\n  get isValid() {\n    return this._el.checkValidity();\n  }\n}\n\nexport class InputView extends HTMLBaseView<InputFieldElement> {\n  readonly type = 'input';\n\n  get checked() {\n    return (this._el as HTMLInputElement).checked || false;\n  }\n\n  set checked(value: boolean) {\n    (this._el as HTMLInputElement).checked = value;\n  }\n\n  get value() {\n    return this._el.value;\n  }\n\n  set value(v) {\n    this._el.value = v;\n  }\n\n  bindVariable(model: Observable, name: string) {\n    if (this._el.type === 'checkbox') {\n      const invert = name.startsWith('!');\n      const inv = (t: boolean) => invert ? !t : t;\n      if (invert) name = name.slice(1);\n\n      if (model[name] !== undefined) {\n        this.checked = inv(model[name]);\n      } else if (this.hasAttr('checked')) {\n        model[name] = inv(this.checked);\n      }\n\n      this.on('change', () => (model[name] = inv(this.checked)));\n      model.watch(() => (this.checked = inv(model[name])));\n      return;\n    }\n\n    if (this._el.type === 'number') {\n      const min = this.hasAttr('min') ? +this.attr('min') : -Infinity;\n      const max = this.hasAttr('max') ? +this.attr('max') : Infinity;\n      this.change((v: string) => {\n        if (v) model[name] = clamp(+v, min, max);\n      });\n    } else {\n      this.change((v: string) => (model[name] = v));\n    }\n\n    if (model[name] !== undefined) {\n      this.value = model[name];\n    } else if (this.value) {\n      model[name] = this.value;\n    }\n\n    // Update the value on blur, in case it doesn't match the clamped value.\n    this.on('blur', () => (this.value = model[name]));\n\n    model.watch(() => {\n      if (document.activeElement !== this._el) this.value = model[name];\n    });\n  }\n\n  /** Polyfill for type and inputmode attributes. */\n  setInputPattern(value: string) {\n    if (isNaN(+value)) return;\n    const digitsOnly = value.match(/^[0-9]+$/);\n    this.setAttr('inputmode', digitsOnly ? 'numeric' : 'decimal');\n    if (digitsOnly) this.setAttr('pattern', '[0-9]*');\n  }\n\n  /** Binds a change event listener. */\n  change(callback: (val: string) => void) {\n    let value = this.value || '';\n    this.on('focus', () => (value = this.value));\n    this.on('change keyup input paste', () => {\n      if (this.value === value) return;\n      value = this.value;\n      callback(value);\n    });\n  }\n\n  validate(callback: (value: string) => string) {\n    this.change(value => this.setValidity(callback(value)));\n  }\n\n  setValidity(str: string) {\n    this._el.setCustomValidity(str);\n  }\n\n  get isValid() {\n    return this._el.checkValidity();\n  }\n}\n\n\n// -----------------------------------------------------------------------------\n// Canvas Elements (<canvas>)\n\nexport class CanvasView extends HTMLBaseView<HTMLCanvasElement> {\n  private _ctx?: CanvasRenderingContext2D;\n  readonly type = 'canvas';\n\n  /** Returns the drawing context for a `<canvas>` element. */\n  getContext(c = '2d', options: WebGLContextAttributes = {}) {\n    return this._el.getContext(c, options);\n  }\n\n  /** Converts a Canvas element into a PNG or JPEG data URI. */\n  image(type:'png'|'jpg' = 'png') {\n    return this._el.toDataURL(type === 'png' ? 'image/png' : 'image/jpeg');\n  }\n\n  /** Returns the intrinsic pixel width of this `<canvas>` element. */\n  get canvasWidth() {\n    return this._el.width;\n  }\n\n  /** Returns the intrinsic pixel height of this `<canvas>` element. */\n  get canvasHeight() {\n    return this._el.height;\n  }\n\n  /** Cached reference to the 2D context for this `<canvas>` element. */\n  get ctx() {\n    if (!this._ctx) this._ctx = this.getContext() as CanvasRenderingContext2D;\n    return this._ctx!;\n  }\n\n  /** Draws a generic geometry object ont a `<canvas>` element. */\n  draw(obj: GeoShape, options: CanvasDrawingOptions = {}) {\n    this.ctx.save();\n    drawCanvas(this.ctx, obj, options);\n    this.ctx.restore();\n  }\n\n  /** Clears this canvas. */\n  clear() {\n    this.ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n  }\n\n  /** Clears this canvas. */\n  fill(color: string) {\n    this.ctx.save();\n    this.ctx.fillStyle = color;\n    this.ctx.fillRect(0, 0, this.canvasWidth, this.canvasHeight);\n    this.ctx.restore();\n  }\n\n  /** Erase a specific circle of the canvas. */\n  clearCircle(center: Point, radius: number) {\n    this.ctx.save();\n    this.ctx.globalCompositeOperation = 'destination-out';\n    this.ctx.beginPath();\n    this.ctx.arc(center.x, center.y, radius, 0, 2 * Math.PI, false);\n    this.ctx.fill();\n    this.ctx.restore();\n  }\n\n  downloadImage(fileName: string) {\n    const href = this.image(fileName.endsWith('.jpg') ? 'jpg' : 'png');\n    const $a = $N('a', {download: fileName, href, target: '_blank'});\n    $a._el.dispatchEvent(new MouseEvent('click',\n      {view: window, bubbles: false, cancelable: true}));\n  }\n}\n\n\n// -----------------------------------------------------------------------------\n// Media Elements (<video> and <audio>)\n\nexport class MediaView extends HTMLBaseView<HTMLMediaElement> {\n\n  /** Starts playback on a media element. */\n  play() {\n    return this._el.play() || Promise.resolve();\n  }\n\n  /** Pauses playback on a media element. */\n  pause() {\n    return this._el.pause();\n  }\n}\n\n\n// -----------------------------------------------------------------------------\n// Element Selectors and Constructors\n\nconst SVG_TAGS = ['path', 'rect', 'circle', 'ellipse', 'polygon', 'polyline',\n  'g', 'defs', 'marker', 'line', 'text', 'tspan', 'pattern', 'mask', 'svg',\n  'foreignObject', 'image', 'use', 'clipPath', 'linearGradient', 'radialGradient'] as const;\n\ntype CreateResult<T extends string> =\n  T extends ('div' | 'p' | 'span') ? HTMLView :\n  T extends 'svg' ? SVGParentView :\n  T extends (typeof SVG_TAGS[number]) ? SVGView :\n  T extends 'canvas' ? CanvasView :\n  T extends 'form' ? FormView :\n  T extends ('input' | 'select' | 'textarea') ? InputView :\n  T extends ('video' | 'audio') ? MediaView :\n  T extends 'x-modal' ? Modal :\n  T extends 'x-popup' ? Popup :\n  T extends 'x-alert' ? Alert :\n  T extends 'x-icon' ? IconView :\n  T extends 'x-select' ? Select :\n  // T extends ('html' | 'body') ? WindowView :\n  ElementView;\n\ntype QueryResult<T extends Element | string> =\n  T extends HTMLDivElement | HTMLSpanElement ? HTMLView :\n  T extends HTMLCanvasElement ? CanvasView :\n  T extends SVGSVGElement ? SVGParentView :\n  T extends SVGElement ? SVGView :\n  T extends Element ? ElementView :\n  T extends string ? CreateResult<T> | undefined :\n  ElementView | undefined;\n\ntype QueryResults<T extends string> =\n  T extends string ? Array<CreateResult<T>> :\n  ElementView[];\n\n/**\n * Finds the Element that matches a specific CSS selector, or creates a new\n * Element wrapper around a native HTMLElement instance.\n */\nexport function $<T extends Element | string>(query?: T,\n  context?: ElementView): QueryResult<T> {\n  if (!query) return undefined as QueryResult<T>;\n\n  const c = context ? context._el : document.documentElement;\n  const el = (typeof query === 'string') ? c.querySelector(query) : query;\n\n  if (!el) return undefined as QueryResult<T>;\n  if ((el as Element)._view) return (el as Element)._view as QueryResult<T>;\n\n  const tagName = ((el as Element).tagName || '').toLowerCase();\n\n  if (tagName === 'svg') {\n    return new SVGParentView(el as SVGSVGElement) as QueryResult<T>;\n  } else if (tagName === 'canvas') {\n    return new CanvasView(el as HTMLCanvasElement) as QueryResult<T>;\n  } else if (tagName === 'form') {\n    return new FormView(el as HTMLFormElement) as QueryResult<T>;\n  } else if (tagName === 'input' || tagName === 'select' || tagName === 'textarea') {\n    return new InputView(el as InputFieldElement) as QueryResult<T>;\n  } else if (tagName === 'video' || tagName === 'audio') {\n    return new MediaView(el as HTMLMediaElement) as QueryResult<T>;\n  } else if ((SVG_TAGS as readonly string[]).includes(tagName)) {\n    // TODO <mask> and <pattern> are not SVGGraphicsElements.\n    return new SVGBaseView<SVGGraphicsElement>(el as SVGGraphicsElement) as QueryResult<T>;\n  } else {\n    return new HTMLBaseView<HTMLElement>(el as HTMLElement) as QueryResult<T>;\n  }\n}\n\n/** Finds all elements that match a specific CSS selector. */\nexport function $$<T extends string>(selector: T,\n  context?: ElementView): QueryResults<T> {\n  const c = context ? context._el : document.documentElement;\n  const els = selector ? c.querySelectorAll(selector as string) : [];\n  return Array.from(els, el => $(el)!) as QueryResults<T>;\n}\n\n/** Creates a new Element instance from a given set of options. */\nexport function $N<T extends string>(tag: T, attributes: Obj<unknown> = {},\n  parent?: ElementView): CreateResult<T> {\n\n  const el = !(SVG_TAGS as readonly string[]).includes(tag) ? document.createElement(tag) :\n    document.createElementNS('http://www.w3.org/2000/svg', tag);\n\n  for (const [key, value] of Object.entries(attributes)) {\n    if (value === undefined) continue;\n    if (key === 'id') {\n      el.id = value as string;\n    } else if (key === 'html') {\n      el.innerHTML = value as string;\n    } else if (key === 'text') {\n      el.textContent = value as string;\n    } else if (key === 'path') {\n      el.setAttribute('d', drawSVG(value as GeoElement));\n    } else {\n      el.setAttribute(key, value as string);\n    }\n  }\n\n  const $el = $(el)!;\n  if (parent) parent.append($el);\n  return $el as CreateResult<T>;\n}\n\nexport const $body = new WindowView(document.body as HTMLBodyElement);\nexport const $html = new WindowView(document.documentElement as HTMLHtmlElement);\n", "// =============================================================================\n// Boost.js | Animations\n// (c) Mathigon\n// =============================================================================\n\n\nimport {defer, delay, Obj, toCamelCase, total} from '@mathigon/core';\nimport {ElementView, HTMLView, SVGView} from './elements';\nimport {Browser} from './browser';\n\n\n// Prevent animations on page load.\nlet isReady = false;\nsetTimeout(() => (isReady = true));\n\nconst BOUNCE_IN = 'cubic-bezier(0.175, 0.885, 0.32, 1.275)';\nconst BOUNCE_OUT = 'cubic-bezier(0.68, -0.275, 0.825, 0.115)';\n\n\n// -----------------------------------------------------------------------------\n// Simple Animations\n\nexport type AnimationCancel = () => void;\nexport type AnimationCallback = (p: number, dt: number, cancel: AnimationCancel) => void;\nexport type AnimationResponse = {cancel: AnimationCancel, promise: Promise<void>};\n\nexport const ResolvedAnimation = {cancel: () => undefined, promise: Promise.resolve()};\n\n\n/**\n * Runs an animation. If no duration is provided, the animation will run\n * indefinitely, and call `callback` with the time since start as first\n * argument. If a duration is provided, the first callback argument is instead\n * the proportion of the duration passed (between 0 and 1). The second callback\n * argument is the time difference since the last animation frame, and the\n * third callback argument is a `cancel()` function to stop the animation.\n */\nexport function animate(callback: AnimationCallback, duration?: number): AnimationResponse {\n\n  if (duration === 0) {\n    callback(1, 0, () => undefined);\n    return ResolvedAnimation;\n  }\n\n  const startTime = Date.now();\n  const deferred = defer<void>();\n\n  let lastTime = 0;\n  let running = true;\n\n  const cancel = () => {\n    running = false;\n    deferred.reject();\n  };\n\n  function getFrame() {\n    if (!running) return;\n    if (!duration || lastTime <= duration) {\n      window.requestAnimationFrame(getFrame);\n    }\n\n    const time = Date.now() - startTime;\n    callback(duration ? Math.min(1, time / duration) : time, time - lastTime, cancel);\n    if (duration && time >= duration) deferred.resolve();\n    lastTime = time;\n  }\n\n  getFrame();\n  return {cancel, promise: deferred.promise};\n}\n\n\n// -----------------------------------------------------------------------------\n// Easing\n\nfunction easeIn(type: string, t = 0, s = 0) {\n  switch (type) {\n    case 'quad':\n      return t ** 2;\n\n    case 'cubic':\n      return t ** 3;\n\n    case 'quart':\n      return t ** 4;\n\n    case 'quint':\n      return t ** 5;\n\n    case 'circ':\n      return 1 - Math.sqrt(1 - t ** 2);\n\n    case 'sine':\n      return 1 - Math.cos(t * Math.PI / 2);\n\n    case 'exp':\n      return (t <= 0) ? 0 : Math.pow(2, 10 * (t - 1));\n\n    case 'back':\n      if (!s) s = 1.70158;\n      return t * t * ((s + 1) * t - s);\n\n    case 'elastic':\n      if (!s) s = 0.3;\n      return -Math.pow(2, 10 * (t - 1)) *\n             Math.sin(((t - 1) * 2 / s - 0.5) * Math.PI);\n\n    case 'swing':\n      return 0.5 - Math.cos(t * Math.PI) / 2;\n\n    case 'spring':\n      return 1 - (Math.cos(t * 4.5 * Math.PI) * Math.exp(-t * 6));\n\n    case 'bounce':\n      if (t < 1 / 11) return 1 / 64 - 7.5625 * (0.5 / 11 - t) * (0.5 / 11 - t);  // 121/16 = 7.5625\n      if (t < 3 / 11) return 1 / 16 - 7.5625 * (2 / 11 - t) * (2 / 11 - t);\n      if (t < 7 / 11) return 1 / 4 - 7.5625 * (5 / 11 - t) * (5 / 11 - t);\n      return 1 - 7.5625 * (1 - t) * (1 - t);\n\n    default:\n      return t;\n  }\n}\n\n/**\n * Applies an easing function to a number `t` between 0 and 1. Options include\n * `quad`, `cubic`, `quart`, `quint`, `circ`, `sine`, `exp`, `back`, `elastic`,\n * `swing`, `spring` and `bounce`, optionally followed by `-in` or `-out`. The\n * `s` parameter is only used by `back` and `elastic` easing.\n */\nexport function ease(type: string, t = 0, s = 0) {\n  if (t === 0) return 0;\n  if (t === 1) return 1;\n  const [name, direction] = type.split('-');\n\n  if (direction === 'in') return easeIn(name, t, s);\n  if (direction === 'out') return 1 - easeIn(name, 1 - t, s);\n  if (t <= 0.5) return easeIn(name, 2 * t, s) / 2;\n  return 1 - easeIn(name, 2 * (1 - t), s) / 2;\n}\n\n\n// -----------------------------------------------------------------------------\n// Element Animations\n\ntype AnimationValue = string|number;\nexport type AnimationProperties = Obj<AnimationValue|AnimationValue[]>;\n\n\nexport function transition($el: ElementView, properties: AnimationProperties,\n  duration = 400, _delay = 0,\n  easing = 'ease-in-out'): AnimationResponse {\n\n  // Don't play animations while the page is loading.\n  if (!isReady) {\n    Object.keys(properties).forEach(k => {\n      const p = properties[k];\n      $el.css(k, Array.isArray(p) ? p[1] : p);\n    });\n    return ResolvedAnimation;\n  }\n\n  if (easing === 'bounce-in') easing = BOUNCE_IN;\n  if (easing === 'bounce-out') easing = BOUNCE_OUT;\n\n  let oldTransition = '';\n  if (Browser.isSafari) {\n    oldTransition = $el._el.style.transition;\n    $el.css('transition', 'none');\n    Browser.redraw();\n  }\n\n  // Cancel any previous animations\n  const currentAnimation = $el._data.animation;\n  if (currentAnimation) (currentAnimation as AnimationResponse).cancel();\n\n  const to: Keyframe = {};\n  const from: Keyframe = {};\n  const deferred = defer<void>();\n\n  const style = window.getComputedStyle($el._el);\n  Object.keys(properties).forEach((k) => {\n    const p = properties[k];\n    const k1 = toCamelCase(k);\n    from[k1] = Array.isArray(p) ? p[0] : style.getPropertyValue(k);\n    to[k1] = Array.isArray(p) ? p[1] : p;\n    // Set initial style, for the duration of the delay.\n    if (_delay) $el.css(k, from[k1]!);\n  });\n\n  // Special rules for animations to height: auto\n  const oldHeight = to.height;\n  if (to.height === 'auto') {\n    const children = $el.children.filter(c => c.css('position') !== 'absolute') as HTMLView[];\n    to.height = `${total(children.map($c => $c.outerHeight))}px`;\n  }\n\n  let player: Animation;\n  let cancelled = false;\n\n  delay(() => {\n    if (cancelled) return;\n\n    player = $el._el.animate([from, to], {duration, easing, fill: 'forwards'});\n    player.onfinish = () => {\n      if ($el._el) {\n        Object.keys(properties).forEach(k => $el.css(k, k === 'height' ? oldHeight! : to[k]!));\n      }\n      if (Browser.isSafari) $el.css('transition', oldTransition);\n      deferred.resolve();\n      player.cancel();  // bit ugly, but needed for Safari...\n      $el._data.animation = undefined;\n    };\n  }, _delay);\n\n  const animation = {\n    cancel() {\n      if (cancelled) return;\n      cancelled = true;\n      if ($el._el) Object.keys(properties).forEach(k => $el.css(k, $el.css(k)));\n      if (player) player.cancel();\n      $el._data.animation = undefined;\n    },\n    promise: deferred.promise\n  };\n\n  // Only allow cancelling of animation in next thread.\n  setTimeout(() => ($el._data.animation = animation));\n  return animation;\n}\n\n\n// -----------------------------------------------------------------------------\n// Element CSS Animations Effects\n\n// When applying the 'pop' effect, we want to respect all existing transform\n// except scale. To do that, we have to expand the matrix() notation.\nconst CSS_MATRIX = /matrix\\([0-9.\\-\\s]+,[0-9.\\-\\s]+,[0-9.\\-\\s]+,[0-9.\\-\\s]+,([0-9.\\-\\s]+),([0-9.\\-\\s]+)\\)/;\n\nexport function enter($el: ElementView, effect = 'fade', duration = 500,\n  _delay = 0): AnimationResponse {\n\n  $el.show();\n  if (!isReady) return ResolvedAnimation;\n  const opacity = $el._data.animation ? 1 : (+$el.css('opacity')!) || 1;\n\n  if (effect === 'fade') {\n    return transition($el, {opacity: [0, opacity]}, duration, _delay);\n\n  } else if (effect === 'pop') {\n    const transform = $el.transform.replace(/scale\\([0-9.]*\\)/, '')\n      .replace(CSS_MATRIX, 'translate($1px,$2px)');\n\n    // TODO Merge into one transition.\n    transition($el, {opacity: [0, opacity]}, duration, _delay);\n    return transition($el, {\n      transform: [`${transform} scale(0.5)`, `${transform} scale(1)`]\n    }, duration, _delay, 'bounce-in');\n\n  } else if (effect === 'descend') {\n    const rules = {opacity: [0, 1], transform: ['translateY(-50%)', 'none']};\n    return transition($el, rules, duration, _delay);\n\n  } else if (effect.startsWith('draw')) {\n    const l = ($el as SVGView).strokeLength;\n    $el.css('stroke-dasharray', `${l}px`);\n    if (!$el.css('opacity')) $el.css('opacity', 1);\n    // Note that Safari can't handle negative dash offsets!\n    const end = (effect === 'draw-reverse') ? `${2 * l}px` : 0;\n    const rules = {'stroke-dashoffset': [`${l}px`, end]};\n    const animation = transition($el, rules, duration, _delay, 'linear');\n    animation.promise.then(() => $el.css('stroke-dasharray', ''));\n    return animation;\n\n  } else if (effect.startsWith('slide')) {\n    const rules = {opacity: [0, opacity], transform: ['translateY(50px)', 'none']};\n    if (effect.includes('down')) rules.transform[0] = 'translateY(-50px)';\n    if (effect.includes('right')) rules.transform[0] = 'translateX(-50px)';\n    if (effect.includes('left')) rules.transform[0] = 'translateX(50px)';\n    return transition($el, rules, duration, _delay);\n\n  } else if (effect.startsWith('reveal')) {\n    const rules: AnimationProperties = {opacity: [0, opacity], height: [0, 'auto']};\n    if (effect.includes('left')) rules.transform = ['translateX(-50%)', 'none'];\n    if (effect.includes('right')) rules.transform = ['translateX(50%)', 'none'];\n    return transition($el, rules, duration, _delay);\n  }\n\n  return ResolvedAnimation;\n}\n\nexport function exit($el: ElementView, effect = 'fade', duration = 400,\n  delay = 0, remove = false): AnimationResponse {\n  if (!$el._el) return ResolvedAnimation;\n\n  if (!isReady) {\n    $el.hide();\n    return ResolvedAnimation;\n  }\n  if ($el.css('display') === 'none') return ResolvedAnimation;\n\n  let animation: AnimationResponse;\n\n  if (effect === 'fade') {\n    animation = transition($el, {opacity: [1, 0]}, duration, delay);\n\n  } else if (effect === 'pop') {\n    const transform = $el.transform.replace(/scale\\([0-9.]*\\)/, '');\n\n    transition($el, {opacity: [1, 0]}, duration, delay);\n    animation = transition($el, {\n      transform: [`${transform} scale(1)`, `${transform} scale(0.5)`]\n    }, duration, delay, 'bounce-out');\n\n  } else if (effect === 'ascend') {\n    const rules = {opacity: [1, 0], transform: ['none', 'translateY(-50%)']};\n    animation = transition($el, rules, duration, delay);\n\n  } else if (effect.startsWith('draw')) {\n    const l = ($el as SVGView).strokeLength;\n    $el.css('stroke-dasharray', l);\n    const start = (effect === 'draw-reverse') ? `${2 * l}px` : 0;\n    const rules = {'stroke-dashoffset': [start, `${l}px`]};\n    animation = transition($el, rules, duration, delay, 'linear');\n\n  } else if (effect.startsWith('slide')) {\n    const rules = {opacity: 0, transform: 'translateY(50px)'};\n    if (effect.includes('up')) rules.transform = 'translateY(-50px)';\n    animation = transition($el, rules, duration, delay);\n\n  } else if (effect.startsWith('reveal')) {\n    const rules: AnimationProperties = {opacity: 0, height: 0};\n    if (effect.includes('left')) rules.transform = 'translateX(-50%)';\n    if (effect.includes('right')) rules.transform = 'translateX(50%)';\n    animation = transition($el, rules, duration, delay);\n  }\n\n  animation!.promise.then(() => remove ? $el.remove() : $el.hide());\n  return animation!;\n}\n", "// =============================================================================\n// Boost.js | Browser Utilities\n// (c) Mathigon\n// =============================================================================\n\n\nimport {Obj, safeToJSON, throttle} from '@mathigon/core';\nimport {$, $body, $html} from './elements';\n\n\ndeclare global {\n  interface Window {\n    BoostBrowser?: BrowserInstance;\n    Touch: unknown;\n    chrome: unknown;\n  }\n}\n\nexport type ResizeEvent = {width: number, height: number};\ntype ResizeCallback = (e: ResizeEvent) => void;\ntype Theme = {name: 'dark'|'light'|'auto', isDark: boolean};\n\nconst STORAGE_KEY = '_M';\nconst UA = window.navigator.userAgent.toLowerCase();\n\nconst MOBILE_REGEX = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i;\nconst IOS_REGEX = /iphone|ipad|ipod/i;\nconst SAFARI_REGEX = /^((?!chrome|android).)*safari/i;\n\n\n// -----------------------------------------------------------------------------\n// Browser Namespace\n\nclass BrowserInstance {\n  readonly isMobile = MOBILE_REGEX.test(UA);\n  readonly isRetina = ((window.devicePixelRatio || 1) > 1);\n  readonly isTouch = (!!window.Touch) || ('ontouchstart' in window);\n\n  readonly isChrome = !!window.chrome;\n  readonly isFirefox = UA.indexOf('firefox') >= 0;\n  readonly isAndroid = UA.indexOf('android') >= 0;\n  readonly isIOS = IOS_REGEX.test(UA);\n  readonly isSafari = IOS_REGEX.test(UA) || SAFARI_REGEX.test(UA);\n\n  constructor() {\n    window.onload = () => this.afterLoad();\n    document.addEventListener('DOMContentLoaded', () => this.afterLoad());\n\n    const applyResizeThrottled = throttle(() => this.applyResize());\n    window.addEventListener('resize', applyResizeThrottled);\n\n    try {\n      this.darkQuery?.addEventListener('change', () => this.applyThemeChange());\n    } catch {\n      // Deprecated, but required for older versions of Safari\n      // https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList/addListener#browser_compatibility\n      this.darkQuery?.addListener(() => this.applyThemeChange());\n    }\n    const initial = this.getCookie('theme');\n    if (initial) this.setTheme(initial as 'dark'|'light'|'auto');\n\n    try {\n      this.localStorage = window.localStorage;\n    } catch {\n      // This could happen when running inside an iFrame\n      console.warn('Unable to access Local Storage in this context.');\n    }\n  }\n\n\n  // ---------------------------------------------------------------------------\n  // Loading Events\n\n  private readonly loadQueue: Array<() => void> = [];\n  private loaded = false;\n\n  private afterLoad() {\n    if (this.loaded) return;\n    this.loaded = true;\n    for (const fn of this.loadQueue) fn();\n    setTimeout(() => this.resize());\n  }\n\n  /** Binds an event listener that is triggered when the page is loaded. */\n  ready(fn: () => void) {\n    if (this.loaded) {\n      fn();\n    } else {\n      this.loadQueue.push(fn);\n    }\n  }\n\n  /** Forces a re-paint. This is useful when updating transition properties. */\n  redraw() {\n    document.body.offsetHeight; /* jshint ignore:line */\n  }\n\n\n  // ---------------------------------------------------------------------------\n  // Resize Events\n\n  width = window.innerWidth;\n  height = window.innerHeight;\n  private readonly resizeCallbacks: ResizeCallback[] = [];\n\n  private applyResize() {\n    const newWidth = window.innerWidth;\n    const newHeight = window.innerHeight;\n    if (this.width === newWidth && this.height === newHeight) return;\n\n    this.width = newWidth;\n    this.height = newHeight;\n\n    for (const fn of this.resizeCallbacks) fn({width: this.width, height: this.height});\n    $body.trigger('scroll', {top: $body.scrollTop});\n  }\n\n  onResize(fn: ResizeCallback) {\n    fn({width: this.width, height: this.height});\n    this.resizeCallbacks.push(fn);\n  }\n\n  offResize(fn: ResizeCallback) {\n    const i = this.resizeCallbacks.indexOf(fn);\n    if (i >= 0) this.resizeCallbacks.splice(i, 1);\n  }\n\n  resize() {\n    this.applyResize();\n  }\n\n\n  // ---------------------------------------------------------------------------\n  // Theme\n\n  readonly theme: Theme = {name: 'light', isDark: false};\n  private readonly themeChangedCallbacks: Array<(theme: Theme) => void> = [];\n  private themeOverride = '';\n  private darkQuery = window.matchMedia?.('(prefers-color-scheme: dark)');\n\n  private applyThemeChange() {\n    const name = this.theme.name;\n    const isDark = name === 'dark' || (name === 'auto' && this.darkQuery.matches);\n\n    if (isDark === this.theme.isDark) return;\n    this.theme.isDark = isDark;\n\n    for (const c of this.themeChangedCallbacks) c(this.theme);\n    setTimeout(() => $html.setAttr('theme', this.themeOverride || (isDark ? 'dark' : 'light')));  // Timeout to fix initial load bug\n  }\n\n  setTheme(name: 'dark'|'light'|'auto') {\n    if (name === this.theme.name) return;\n    this.theme.name = name;\n    this.setCookie('theme', name);\n    this.applyThemeChange();\n  }\n\n  onThemeChange(fn: (theme: Theme) => void) {\n    this.themeChangedCallbacks.push(fn);\n  }\n\n\n  // ---------------------------------------------------------------------------\n  // Location\n\n  /** Returns the hash string of the current window. */\n  getHash() {\n    return window.location.hash.slice(1);\n  }\n\n  /** Set the hash string of the current window. */\n  setHash(h: string) {\n    // Prevent scroll to top when resetting hash.\n    const scroll = document.body.scrollTop;\n    window.location.hash = h;\n    document.body.scrollTop = scroll;\n  }\n\n  /** Set the URL of the current window. */\n  setURL(url: string, title = '') {\n    window.history.replaceState({}, title, url);\n    if (title) window.document.title = title;\n  }\n\n\n  // ---------------------------------------------------------------------------\n  // Cookies\n\n  /** Returns a JSON object of all cookies. */\n  getCookies() {\n    const pairs = document.cookie.split(';');\n    const result: Obj<string> = {};\n    for (let i = 0, n = pairs.length; i < n; ++i) {\n      const pair = pairs[i].split('=');\n      result[decodeURIComponent(pair[0]).trim()] = decodeURIComponent(pair[1]);\n    }\n    return result;\n  }\n\n  getCookie(name: string) {\n    const v = document.cookie.match(new RegExp(`(^|;) ?${name}=([^;]*)(;|$)`));\n    return v ? v[2] : undefined;\n  }\n\n  setCookie(name: string, value: unknown, maxAge = 60 * 60 * 24 * 365) {\n    // Cookies are also set for all subdomains. Remove locale subdomains.\n    const domain = window.location.hostname.replace(/^[a-z]{2}\\./, '');\n    document.cookie = `${name}=${value};path=/;max-age=${maxAge};domain=${domain}`;\n  }\n\n  deleteCookie(name: string) {\n    this.setCookie(name, '', -1);\n  }\n\n\n  // ---------------------------------------------------------------------------\n  // Local Storage\n\n  private localStorage?: Storage;\n\n  setStorage(key: string, value: unknown) {\n    const keys = (key || '').split('.');\n    const storage = safeToJSON(this.localStorage?.getItem(STORAGE_KEY) || undefined, {});\n    let path: any = storage;\n\n    for (let i = 0; i < keys.length - 1; ++i) {\n      if (path[keys[i]] === undefined) path[keys[i]] = {};\n      path = path[keys[i]];\n    }\n\n    path[keys[keys.length - 1]] = value;\n    this.localStorage?.setItem(STORAGE_KEY, JSON.stringify(storage));\n  }\n\n  getStorage(key: string) {\n    let path: any = safeToJSON(this.localStorage?.getItem(STORAGE_KEY), {});\n    if (!key) return path;\n\n    const keys = (key || '').split('.');\n    const lastKey = keys.pop()!;\n\n    for (const k of keys) {\n      if (!(k in path)) return;\n      path = path[k];\n    }\n    return path[lastKey];\n  }\n\n  deleteStorage(key: string) {\n    if (key) {\n      this.setStorage(key, undefined);\n    } else {\n      this.localStorage?.setItem(STORAGE_KEY, '');\n    }\n  }\n\n\n  // ---------------------------------------------------------------------------\n  // Keyboard Event Handling\n\n  /** The current active element on the page (e.g. and `<input>`). */\n  getActiveInput() {\n    let active = document.activeElement;\n    if (active?.shadowRoot) active = active.shadowRoot.activeElement;\n    return active === document.body ? undefined : $(active as HTMLElement);\n  }\n\n  get formIsActive() {\n    return !!this.getActiveInput()?.is('input, select, textarea, [contenteditable]');\n  }\n}\n\n// Ensure we only create one Browser class during the lifetime of a page.\nexport const Browser = window.BoostBrowser || new BrowserInstance();\nwindow.BoostBrowser = Browser;\n\n\n// -----------------------------------------------------------------------------\n// Polyfill for external SVG imports\n\nconst IEUA = /\\bTrident\\/[567]\\b|\\bMSIE (?:9|10)\\.0\\b/;\nconst webkitUA = /\\bAppleWebKit\\/(\\d+)\\b/;\nconst EdgeUA = /\\bEdge\\/12\\.(\\d+)\\b/;\n\nconst polyfill = IEUA.test(navigator.userAgent) ||\n                 +(navigator.userAgent.match(EdgeUA) || [])[1] < 10547 ||\n                 +(navigator.userAgent.match(webkitUA) || [])[1] < 537;\n\nconst requests: Obj<Promise<string>> = {};\n\n/** Replaces SVG `<use>` imports that are not supported by older browsers. */\nexport function replaceSvgImports() {\n  if (!polyfill) return;\n\n  const uses = Array.from(document.querySelectorAll('svg > use'));\n  uses.forEach(function(use) {\n    const src = use.getAttribute('xlink:href')!;\n    const [url, id] = src.split('#');\n    if (!url.length || !id) return;\n\n    const svg = use.parentNode!;\n    svg.removeChild(use);\n\n    if (!(url in requests)) requests[url] = fetch(url).then(r => r.text());\n    const request = requests[url];\n\n    request.then((response) => {\n      const doc = document.implementation.createHTMLDocument('');\n      doc.documentElement.innerHTML = response;\n\n      const icon = doc.getElementById(id)!;\n      const clone = icon.cloneNode(true);\n\n      const fragment = document.createDocumentFragment();\n      while (clone.childNodes.length) fragment.appendChild(clone.firstChild!);\n      svg.appendChild(fragment);\n    });\n  });\n}\n\n\n// -----------------------------------------------------------------------------\n// Accessibility and Keyboard Events\n\nconst KEY_FALLBACKS = new Map(Object.entries({\n  ' ': 'Space',\n  'Spacebar': 'Space',\n  'Del': 'Delete',\n  'Esc': 'Escape',\n  'Left': 'ArrowLeft',\n  'Right': 'ArrowRight',\n  'Down': 'ArrowDown',\n  'Up': 'ArrowUp'\n}));\n\nexport function keyCode(e: KeyboardEvent) {\n  return KEY_FALLBACKS.get(e.key) || e.key;\n}\n\nexport function bindAccessibilityEvents(parent?: HTMLElement) {\n  const KEYS = new Set(['Enter', 'Space']);\n  let isDown = false;\n  document.addEventListener('keyup', (e: KeyboardEvent) => {\n    // Prevent click events being triggered multiple times when holding a key.\n    if (KEYS.has(keyCode(e))) isDown = false;\n  });\n  (parent || document as any).addEventListener('keydown', (e: KeyboardEvent) => {\n    if (!isDown && KEYS.has(keyCode(e))) {\n      isDown = true;\n      const $active = Browser.getActiveInput();\n      // The CodeMirror library adds tabindex attributes on their <textarea> fields.\n      if ($active && $active.hasAttr('tabindex') && $active.tagName !== 'TEXTAREA') {\n        e.preventDefault();\n        $active.trigger('pointerdown', e);\n        $active.trigger('pointerstop', e);\n        $body.trigger('pointerstop', e);\n        $active.trigger('click', e);\n      }\n    }\n  });\n}\n", "// =============================================================================\n// Boost.js | Expression Parsing\n// Based on http://jsep.from.so\n// (c) Mathigon\n// =============================================================================\n\n\nimport {Obj} from '@mathigon/core';\n\n\n// -----------------------------------------------------------------------------\n// Interfaces\n\nenum NODE_TYPE {\n  Array,\n  BinaryOp,\n  Call,\n  Conditional,\n  Identifier,\n  Literal,\n  Member,\n  UnaryOp,\n}\n\ninterface ArrayNode {\n  type: NODE_TYPE.Array;\n  elements: AnyNode[];\n}\n\ninterface BinaryNode {\n  type: NODE_TYPE.BinaryOp;\n  operator: string;\n  left: AnyNode;\n  right: AnyNode;\n}\n\ninterface CallNode {\n  type: NODE_TYPE.Call;\n  callee: AnyNode;\n  args: AnyNode[];\n}\n\ninterface ConditionalNode {\n  type: NODE_TYPE.Conditional;\n  test: AnyNode;\n  consequent: AnyNode;\n  alternate: AnyNode;\n}\n\ninterface IdentifierNode {\n  type: NODE_TYPE.Identifier;\n  name: string;\n}\n\ninterface LiteralNode {\n  type: NODE_TYPE.Literal;\n  value: any;\n}\n\ninterface MemberNode {\n  type: NODE_TYPE.Member;\n  object: AnyNode,\n  computed: boolean,\n  property: AnyNode\n}\n\ninterface UnaryNode {\n  type: NODE_TYPE.UnaryOp;\n  operator: string;\n  argument: any;\n}\n\ntype AnyNode = ArrayNode|BinaryNode|CallNode|ConditionalNode|IdentifierNode\n               |LiteralNode|MemberNode|UnaryNode;\n\n\n// -----------------------------------------------------------------------------\n// Constants\n\nconst BINARY_OPS: Obj<(a: unknown, b: unknown) => unknown> = {\n  // TODO Operator overloading (e.g. add vectors or complex numbers)\n  '===': (a: unknown, b: unknown) => a === b,\n  '!==': (a: unknown, b: unknown) => a !== b,\n  '||': (a: unknown, b: unknown) => a || b,\n  '&&': (a: unknown, b: unknown) => a && b,\n  // eslint-disable-next-line eqeqeq\n  '==': (a: unknown, b: unknown) => a == b,\n  // eslint-disable-next-line eqeqeq\n  '!=': (a: unknown, b: unknown) => a != b,\n  '<=': (a: any, b: any) => a <= b,\n  '>=': (a: any, b: any) => a >= b,\n  '**': (a: any, b: any) => a ** b,\n  '<': (a: any, b: any) => a < b,\n  '>': (a: any, b: any) => a > b,\n  '+': (a: any, b: any) => a + b,\n  '-': (a: any, b: any) => a - b,\n  '*': (a: any, b: any) => a * b,\n  '/': (a: any, b: any) => a / b,\n  '%': (a: any, b: any) => a % b\n};\n\nconst UNARY_OPS: Obj<(a: any) => any> = {\n  '-': (a: any) => -a,\n  '+': (a: any) => +a,\n  '!': (a: any) => !a\n};\n\n// Binary operations with their precedence\nconst BINARY_PRECEDENCE: Obj<number> = {\n  '||': 1, '&&': 2,\n  '==': 3, '!=': 3, '===': 3, '!==': 3,\n  '<': 4, '>': 4, '<=': 4, '>=': 4,\n  '+': 5, '-': 5,\n  '*': 6, '/': 6, '%': 6,\n  '**': 7  // TODO Exponentiation should be right-to-left.\n};\n\nconst LITERALS: Obj<boolean|undefined> = {\n  'true': true,\n  'false': false,\n  'undefined': undefined\n};\n\nconst SPACE = /\\s/;\nconst DIGIT = /[0-9]/;\nconst IDENTIFIER_START = /[a-zA-Z\u03B1-\u03C9\u0391-\u03A9$_]/;  // Variables cannot start with a number.\nconst IDENTIFIER_PART = /[0-9a-zA-Z\u03B1-\u03C9\u0391-\u03A9$_]/;\n\n\n// -----------------------------------------------------------------------------\n// Expression Parser\n\nfunction parseSyntaxTree(expr: string) {\n  const length = expr.length;\n  let index = 0;  // Current cursor position\n\n  function throwError(message: string): never {\n    throw new Error(`${message} at character ${index} of \"${expr}\"`);\n  }\n\n  function gobbleSpaces() {\n    while (SPACE.test(expr[index])) index += 1;\n  }\n\n  // Gobble a simple numeric literals (e.g. `12`, `3.4`, `.5`).\n  function gobbleNumericLiteral(): LiteralNode {\n    const number = expr.slice(index).match(/^\\d*(\\.\\d+)?([eE][+-]?\\d+)?/)?.[0] || '';\n    index += number.length;\n\n    const char = expr[index];\n    if (char && (IDENTIFIER_START.test(char) || char === '.')) {\n      throwError(`Unexpected character (${number + char})`);\n    }\n\n    return {type: NODE_TYPE.Literal, value: parseFloat(number)};\n  }\n\n  // Gobble a string literal, staring with single or double quotes.\n  function gobbleStringLiteral(): LiteralNode {\n    const quote = expr[index];\n    index += 1;\n\n    let closed = false;\n    let string = '';\n\n    while (index < length) {\n      const char = expr[index++];\n      if (char === quote) {\n        closed = true;\n        break;\n      }\n      string += char;\n    }\n\n    if (!closed) throwError(`Unclosed quote after \"${string}\"`);\n    return {type: NODE_TYPE.Literal, value: string};\n  }\n\n  // Gobbles identifiers and literals (e.g. `foo`, `_value`, `$x1`, `true`).\n  function gobbleIdentifier(): LiteralNode|IdentifierNode {\n    let name = expr[index];\n    if (!IDENTIFIER_START.test(expr[index])) throwError(`Unexpected ${name}`);\n    index += 1;\n\n    while (index < length) {\n      if (IDENTIFIER_PART.test(expr[index])) {\n        name += expr[index++];\n      } else {\n        break;\n      }\n    }\n\n    if (name in LITERALS) {\n      return {type: NODE_TYPE.Literal, value: LITERALS[name]};\n    } else {\n      return {type: NODE_TYPE.Identifier, name};\n    }\n  }\n\n  // Gobbles a list of arguments within a function call or array literal. It\n  // assumes that the opening character has already been gobbled (e.g.\n  // `foo(bar, baz)`, `my_func()`, or `[bar, baz]`).\n  function gobbleArguments(termination: ')'|']'): AnyNode[] {\n    const args: AnyNode[] = [];\n    let closed = false;\n    let lastArg: AnyNode|undefined = undefined;\n\n    while (index < length) {\n      if (expr[index] === termination) {\n        if (lastArg) args.push(lastArg);\n        closed = true;\n        index += 1;\n        break;\n      } else if (expr[index] === ',') {\n        args.push(lastArg || {type: NODE_TYPE.Literal, value: undefined});\n        index += 1;\n      } else {\n        lastArg = gobbleExpression();\n      }\n    }\n\n    if (!closed) throwError(`Expected ${termination}`);\n    return args;\n  }\n\n  // Parse a non-literal variable name. It name may include properties (`foo`,\n  // `bar.baz`, `foo['bar'].baz`) or function calls (`Math.acos(obj.angle)`).\n  function gobbleVariable(): AnyNode {\n    let node: AnyNode;\n\n    if (expr[index] === '(') {\n      index += 1;\n      node = gobbleExpression()!;\n      gobbleSpaces();\n      if (expr[index] === ')') {\n        index += 1;\n        return node;\n      } else {\n        throwError('Unclosed (');\n      }\n    } else {\n      node = gobbleIdentifier();\n    }\n\n    gobbleSpaces();\n\n    while ('.[('.includes(expr[index])) {\n      if (expr[index] === '.') {\n        // Object property accessors.\n        index++;\n        gobbleSpaces();\n        node = {\n          type: NODE_TYPE.Member,\n          object: node!,\n          computed: false,\n          property: gobbleIdentifier()\n        };\n      } else if (expr[index] === '[') {\n        // Array index accessors.\n        index++;\n        node = {\n          type: NODE_TYPE.Member,\n          object: node!,\n          computed: true,\n          property: gobbleExpression()!\n        };\n        gobbleSpaces();\n        if (expr[index] !== ']') throwError('Unclosed [');\n        index++;\n      } else if (expr[index] === '(') {\n        // A function call is being made; gobble all the arguments\n        index++;\n        node = {\n          type: NODE_TYPE.Call,\n          args: gobbleArguments(')'),\n          callee: node\n        };\n      }\n      gobbleSpaces();\n    }\n\n    return node;\n  }\n\n  // Search for the operation portion of the string (e.g. `+`, `===`)\n  function gobbleBinaryOp(): string|undefined {\n    gobbleSpaces();\n    for (const length of [3, 2, 1]) {  // Different possible operator lengths\n      const substr = expr.substr(index, length);\n      if (substr in BINARY_OPS) {\n        index += length;\n        return substr;\n      }\n    }\n  }\n\n  // Parse an individual part of a binary expression (e.g. `foo.bar(baz)`, `1`,\n  // `\"abc\"` or `(a % 2)` because it is in parenthesis).\n  // TODO Support expressions like `[a, b][c]` or `([a, b])[c]`.\n  function gobbleToken(): AnyNode|UnaryNode {\n    gobbleSpaces();\n    const operator = expr[index];\n\n    if (DIGIT.test(operator) || operator === '.') {\n      return gobbleNumericLiteral();\n    } else if (operator === '\\'' || operator === '\"') {\n      // Single or double quotes\n      return gobbleStringLiteral();\n    } else if (operator === '[') {\n      index += 1;\n      return {type: NODE_TYPE.Array, elements: gobbleArguments(']')};\n    } else if (operator in UNARY_OPS) {\n      index += 1;\n      return {type: NODE_TYPE.UnaryOp, operator, argument: gobbleToken()};\n    } else if (IDENTIFIER_START.test(operator) || operator === '(') {\n      // `foo`, `bar.baz`\n      return gobbleVariable();\n    }\n\n    throwError('Expression parsing error');\n  }\n\n  // Parse individual expressions (e.g. `1`, `1+2`, `a+(b*2)-Math.sqrt(2)`)\n  function gobbleBinaryExpression(): AnyNode {\n    let left = gobbleToken();\n\n    let biop = gobbleBinaryOp();\n    if (!biop) return left;\n\n    let right = gobbleToken();\n    if (!right) throwError(`Expected expression after ${biop}`);\n\n    // If there are multiple binary operators, we have to stack them in the\n    // correct order using recursive descent.\n\n    let node: AnyNode;\n    const stack = [left, biop, right];\n\n    while ((biop = gobbleBinaryOp())) {\n      const prec = BINARY_PRECEDENCE[biop];\n      const curBiop = biop;\n\n      while (stack.length > 2 && prec <=\n             BINARY_PRECEDENCE[stack[stack.length - 2] as string]) {\n        right = stack.pop() as AnyNode;\n        biop = stack.pop() as string;\n        left = stack.pop() as AnyNode;\n        node = {type: NODE_TYPE.BinaryOp, operator: biop, left, right};\n        stack.push(node);\n      }\n\n      node = gobbleToken();\n      if (!node) throwError(`Expected expression after ${curBiop}`);\n      stack.push(curBiop, node);\n    }\n\n    let i = stack.length - 1;\n    node = stack[i] as AnyNode;\n    while (i > 1) {\n      node = {\n        type: NODE_TYPE.BinaryOp, operator: stack[i - 1] as string,\n        left: stack[i - 2] as AnyNode, right: node\n      };\n      i -= 2;\n    }\n\n    return node;\n  }\n\n  // Parse ternary expressions (e.g. `a ? b : c`).\n  function gobbleExpression(): AnyNode|undefined {\n    const test = gobbleBinaryExpression();\n    gobbleSpaces();\n\n    if (test && expr[index] === '?') {\n      // Ternary expression: test ? consequent : alternate\n      index += 1;\n      const consequent = gobbleExpression();\n      if (!consequent) throwError('Expected expression');\n      gobbleSpaces();\n      if (expr[index] === ':') {\n        index++;\n        const alternate = gobbleExpression();\n        if (!alternate) throwError('Expected expression');\n        return {type: NODE_TYPE.Conditional, test, consequent, alternate};\n      } else {\n        throwError('Expected :');\n      }\n    } else {\n      return test;\n    }\n  }\n\n  const node = gobbleExpression();\n  if (index < expr.length) throwError(`Unexpected \"${expr[index]}\"`);\n  return node;\n}\n\n\n// -----------------------------------------------------------------------------\n// Evaluations\n\nconst EMPTY: [undefined, undefined] = [undefined, undefined];\ntype State = Record<string, unknown>;\n\nconst FORBIDDEN_KEYS = ['__proto__', 'constructor', 'prototype'];\n\n/**\n * Returns [value, this]. We need to keep track of the `this` value so that\n * we can correctly set the context for object member method calls. Unlike\n * normal JavaScript,\n * (1) We evaluate all arguments or logical/ternary operators, so that we can\n *     correctly track dependencies in an Observable() context.\n * (2) All operations are \"safe\", i.e. when one of the arguments is undefined,\n *     we return undefined, rather than throwing an error.\n */\nfunction evaluate(node: AnyNode, context: State, local: State): [any, any] {\n  /* eslint-disable no-case-declarations */\n  switch (node.type) {\n    case NODE_TYPE.Array:\n      const v1 = node.elements.map((n) => evaluate(n, context, local)[0]);\n      if (v1.some(v => v === undefined)) return EMPTY;\n      return [v1, undefined];\n\n    case NODE_TYPE.BinaryOp:\n      const left = evaluate(node.left, context, local)[0];\n      const right = evaluate(node.right, context, local)[0];\n      if ('+-**/%'.includes(node.operator) && (left === undefined || right === undefined)) return EMPTY;\n      return [BINARY_OPS[node.operator](left, right), undefined];\n\n    case NODE_TYPE.Call:\n      // Note: we evaluate arguments even if fn is undefined.\n      const [fn, self] = evaluate(node.callee, context, local);\n\n      // XSS / sandbox escape mitigation:\n      if (fn === Function || fn === eval) return EMPTY;\n\n      const args = node.args.map((n) => evaluate(n, context, local)[0]);\n      if (args.some(v => v === undefined) || typeof fn !== 'function') return EMPTY;\n      return [fn.apply(self, args), undefined];\n\n    case NODE_TYPE.Conditional:\n      // Note: we evaluate all possible options of the unary operator.\n      const consequent = evaluate(node.consequent, context, local);\n      const alternate = evaluate(node.alternate, context, local);\n      return evaluate(node.test, context, local)[0] ? consequent : alternate;\n\n    case NODE_TYPE.Identifier:\n      if (FORBIDDEN_KEYS.includes(node.name)) return EMPTY;\n      return [local[node.name] || context[node.name], undefined];\n\n    case NODE_TYPE.Literal:\n      return [node.value, undefined];\n\n    case NODE_TYPE.Member:\n      const object = evaluate(node.object, context, local)[0];\n      const property = node.computed ? evaluate(node.property, context, local)[0] :\n        (node.property as IdentifierNode).name;\n      if (FORBIDDEN_KEYS.includes(property)) return EMPTY;\n      return object ? [object[property], object] : [undefined, undefined];\n\n    case NODE_TYPE.UnaryOp:\n      const arg = evaluate(node.argument, context, local)[0];\n      // For the ! operator, we allow undefined arguments.\n      if (arg === undefined && node.operator !== '!') return EMPTY;\n      return [UNARY_OPS[node.operator](arg), undefined];\n  }\n}\n\n/**\n * Compiles a JS expression into a function that can be evaluated with context.\n */\nexport function compile<T = any>(expr: string) {\n  const node = parseSyntaxTree(expr);\n  if (!node) return (_context: any = {}) => undefined;\n  return (context = {}, local = {}): T|undefined => evaluate(node, context, local)[0];\n}\n\n\n// -----------------------------------------------------------------------------\n// Template Strings\n\nconst TEMPLATE = /\\${([^}]+)}/g;\n\n/**\n * Converts an expression string into an executable JS function. It will replace\n * all `${x}` type expressions and evaluate them based on a context.\n */\nexport function compileString(expr: string, isAttribute = false): (vars: any) => string {\n  // This array contains the alternating static and variable parts of the expr.\n  // For example, the input expression `Here ${is} some ${text}` would give\n  // parts = ['Here ', 'is', ' some ', 'text', ''].\n  const parts = expr.split(TEMPLATE);\n  const fns = parts.map((p, i) => (i % 2) ? compile(p.replace(/\u00D7/g, '*')) : undefined);\n\n  return (context: any) => {\n    return parts.map((p, i) => {\n      if (!(i % 2)) return p;\n      const value = fns[i]!(context);\n      // Special formatting for negative numbers.\n      return (!isAttribute && typeof value === 'number' && value < 0) ? `\u2013${-value}` : value;\n    }).join('');\n  };\n}\n", "// =============================================================================\n// Boost.js | DOM Events\n// (c) Mathigon\n// =============================================================================\n\n\nimport {delay, Obj, words} from '@mathigon/core';\nimport {Point} from '@mathigon/euclid';\nimport {$, $body, CanvasView, ElementView, InputView, SVGParentView, SVGView} from './elements';\nimport {Browser} from './browser';\n\n\ndeclare global {\n  interface Window {\n    IntersectionObserver?: IntersectionObserver;\n    ResizeObserver: any;\n  }\n\n  interface Event {\n    handled?: boolean;\n  }\n}\n\n\n// -----------------------------------------------------------------------------\n// Utilities\n\nexport type ScreenEvent = PointerEvent|TouchEvent|MouseEvent;\nexport type ScrollEvent = {top: number};\nexport type EventCallback = (e: any) => void;\n\nconst touchSupport = ('ontouchstart' in window);\nconst pointerSupport = ('onpointerdown' in window);\n\n\n/** Gets the pointer position from an event. */\nexport function pointerPosition(e: any) {\n  if (e.touches) {\n    const touches = e.targetTouches.length ? e.targetTouches : e.changedTouches;\n    return new Point(touches[0].clientX, touches[0].clientY);\n  } else {\n    return new Point(e.clientX || 0, e.clientY || 0);\n  }\n}\n\nfunction getTouches(e: any) {\n  return e.touches || [];\n}\n\n/**\n * Gets the pointer position from an event triggered on an `<svg>` element, in\n * the coordinate system of the `<svg>` element.\n */\nexport function svgPointerPosn(event: ScreenEvent, $svg: SVGParentView) {\n  const posn = pointerPosition(event);\n  return posn.transform($svg.inverseTransformMatrix);\n}\n\n/**\n * Gets the pointer position from an event triggered on an `<canvas>` element,\n * in the coordinate system of the `<canvas>` element.\n */\nexport function canvasPointerPosition(event: ScreenEvent, $canvas: CanvasView) {\n  const posn = pointerPosition(event);\n  const bounds = $canvas.bounds;\n\n  const x = (posn.x - bounds.left) * $canvas.canvasWidth / bounds.width;\n  const y = (posn.y - bounds.top) * $canvas.canvasHeight / bounds.height;\n  return new Point(x, y);\n}\n\n/**\n * Get the target element for an event, including for touch/pointer events\n * that started on a different element.\n */\nexport function getEventTarget(event: ScreenEvent) {\n  if (event instanceof PointerEvent && event.pointerType === 'mouse') {\n    // Only pointer mouse events update the target for move events that started\n    // on a different element.\n    return $(event.target as Element);\n  }\n\n  const posn = pointerPosition(event);\n  return $(document.elementFromPoint(posn.x, posn.y) || undefined);\n}\n\n\n// -----------------------------------------------------------------------------\n// Click Events\n\nfunction makeTapEvent($el: ElementView) {\n  // TODO Support removing events.\n\n  if ($el._data['tapEvent']) return;\n  $el._data['tapEvent'] = true;\n\n  let start: Point|undefined = undefined;\n\n  $el.on('pointerdown', (e: ScreenEvent) => (start = pointerPosition(e)));\n\n  $el.on('pointerup', (e: ScreenEvent) => {\n    if (!start) return;\n    const end = pointerPosition(e);\n    if (Point.distance(start, end) < 6) $el.trigger('tap', e);\n    start = undefined;\n  });\n\n  $el.on('pointercancel', () => (start = undefined));\n}\n\nfunction makeClickOutsideEvent($el: ElementView) {\n  // TODO Support removing events.\n\n  if ($el._data['clickOutsideEvent']) return;\n  $el._data['clickOutsideEvent'] = true;\n\n  $body.on('pointerdown', (e: ScreenEvent) => {\n    // The .composedPath method ensures that this still works in shadow DOM.\n    const target = (e.composedPath()[0] || e.target) as Node|null;\n    if (!target || $el._el === target || $el._el.contains(target)) return;\n    $el.trigger('clickOutside', e);\n  });\n}\n\n\n// -----------------------------------------------------------------------------\n// Slide Events\n\ninterface SlideEventOptions {\n  down?: (p: Point) => void;\n  start?: (p: Point) => void;\n  move?: (p: Point, start: Point, last: Point) => void;\n  end?: (last: Point, start: Point) => void;\n  up?: (last: Point, start: Point) => void;\n  click?: (p: Point) => void;\n  justInside?: boolean;\n  accessible?: boolean;\n  $box?: ElementView;\n}\n\nexport function slide($el: ElementView, fns: SlideEventOptions) {\n  const $box = fns.$box || $el;\n  let posn = pointerPosition;\n  if ($box.type === 'svg') {\n    posn = (e) => svgPointerPosn(e, ($box as SVGView).$ownerSVG);\n  } else if ($box.type === 'canvas') {\n    posn = (e) => canvasPointerPosition(e, $box as CanvasView);\n  }\n\n  const $parent = fns.justInside ? $el : $body;\n\n  let startPosn: Point|undefined = undefined;\n  let lastPosn: Point|undefined = undefined;\n\n  let hasMoved = false;\n  let pointerId = 0;\n\n  if ($el.css('touch-action') === 'auto') $el.css('touch-action', 'none');\n  $el.addClass('noselect');\n\n  function start(e: ScreenEvent) {\n    if (e.handled || getTouches(e).length > 1) return;\n    e.preventDefault();\n\n    hasMoved = false;\n    pointerId = (e as any).pointerId || 0;\n\n    $parent.on('pointermove', move);\n    $parent.on('pointerstop', end);\n\n    startPosn = lastPosn = posn(e);\n    if (fns.down) fns.down(startPosn);\n  }\n\n  function move(e: ScreenEvent) {\n    if (!startPosn) return;\n    if (pointerId && (e as any).pointerId !== pointerId) return;\n    e.preventDefault();\n\n    const p = posn(e);\n    if (Point.distance(p, lastPosn!) < 0.5) return;\n\n    if (!hasMoved && fns.start) fns.start(startPosn!);\n    if (fns.move) fns.move(p, startPosn!, lastPosn!);\n\n    lastPosn = p;\n    hasMoved = true;\n  }\n\n  function end(e: ScreenEvent, preventClick = false) {\n    if (!startPosn) return;\n    if (pointerId && (e as any).pointerId !== pointerId) return;\n    e.preventDefault();\n\n    $parent.off('pointermove', move);\n    $parent.off('pointerstop', end);\n\n    if (fns.up) fns.up(lastPosn!, startPosn!);\n    if (hasMoved && fns.end) fns.end(lastPosn!, startPosn!);\n    if (!hasMoved && fns.click && !preventClick) fns.click(startPosn!);\n    startPosn = undefined;\n  }\n\n  // Cancel running slide gestures when pressing escape.\n  $body.onKey('Escape', () => {\n    if (!startPosn) return;\n    // Move the element back to the start position.\n    if (hasMoved && fns.move) fns.move(startPosn, startPosn, lastPosn!);\n    lastPosn = startPosn;\n    const event = document.createEvent('MouseEvent');\n    (event as any).pointerId = pointerId;\n    end(event, true);\n  });\n\n  $el.on('pointerdown', start);\n  if (fns.justInside) $el.on('mouseleave', end);\n\n  if (fns.accessible) {\n    $el.setAttr('tabindex', '0');\n    document.addEventListener('keydown', (e: KeyboardEvent) => {\n      if (![37, 38, 39, 40].includes(e.keyCode)) return;\n      if ($el !== Browser.getActiveInput()) return;\n\n      const center = $el.boxCenter;\n      const start = posn({clientX: center.x, clientY: center.y});\n\n      const dx = (e.keyCode === 37) ? -25 : (e.keyCode === 39) ? 25 : 0;\n      const dy = (e.keyCode === 38) ? -25 : (e.keyCode === 40) ? 25 : 0;\n      const end = start.shift(dx, dy);\n\n      if (fns.down) fns.down(start);\n      if (fns.start) fns.start(start);\n      if (fns.move) fns.move(end, start, start);\n      if (fns.end) fns.end(end, start);\n    });\n  }\n}\n\n\n// -----------------------------------------------------------------------------\n// Slide Events\n\ninterface OverEventOptions {\n  enter?: () => void;\n  move?: (p: Point) => void;\n  exit?: () => void;\n}\n\nexport function pointerOver($el: ElementView, fns: OverEventOptions) {\n  let posn = pointerPosition;\n  if ($el.type === 'svg') {\n    posn = (e) => svgPointerPosn(e, ($el as SVGView).$ownerSVG);\n  } else if ($el.type === 'canvas') {\n    posn = (e) => canvasPointerPosition(e, $el as CanvasView);\n  }\n\n  let over = false;\n\n  $el.on('touchstart mouseenter', (e: Event) => {\n    if (!over && fns.enter) fns.enter();\n    if (fns.move) fns.move(posn(e));\n    over = true;\n  }, {passive: true});\n\n  $el.on('pointermove', (e: Event) => {\n    if (over && fns.move) fns.move(posn(e));\n  });\n\n  $el.on('touchend mouseleave', () => {\n    if (over && fns.exit) fns.exit();\n    over = false;\n  }, {passive: true});\n}\n\n\n// -----------------------------------------------------------------------------\n// Scroll Events\n\nfunction makeScrollEvents($el: ElementView) {\n  // TODO Support removing events.\n\n  if ($el._data['scrollEvents']) return;\n  $el._data['scrollEvents'] = true;\n\n  let ticking = false;\n  let top: number|undefined = undefined;\n\n  function tick() {\n    const newTop = $el.scrollTop;\n    if (newTop === top) {\n      ticking = false;\n      return;\n    }\n\n    top = newTop;\n    $el.trigger('scroll', {top});\n    // TODO Scroll should trigger mousemove events.\n    window.requestAnimationFrame(tick);\n  }\n\n  function scroll() {\n    if (!ticking) window.requestAnimationFrame(tick);\n    ticking = true;\n  }\n\n  // Mouse Events\n  const target = $el.type === 'window' ? window : $el._el;\n  target.addEventListener('scroll', scroll);\n\n  // Touch Events\n  function touchStart() {\n    window.addEventListener('touchmove', scroll);\n    window.addEventListener('touchend', touchEnd);\n  }\n\n  function touchEnd() {\n    window.removeEventListener('touchmove', scroll);\n    window.removeEventListener('touchend', touchEnd);\n  }\n\n  $el._el.addEventListener('touchstart', function(e) {\n    if (!e.handled) touchStart();\n  });\n}\n\n\n// -----------------------------------------------------------------------------\n// Hover Events\n\ninterface HoverEventOptions {\n  enter?: () => void;\n  exit?: () => void;\n  preventMouseover?: () => boolean;\n  canFocusWithin?: boolean;\n  delay?: number;\n  exitDelay?: number;\n  $clickTarget?: ElementView;\n}\n\nexport function hover($el: ElementView, options: HoverEventOptions) {\n  const $clickTarget = options.$clickTarget || $el;\n\n  let timeout = 0;\n  let active = false;\n  let wasTriggeredByMouse = false;\n  let wasTriggeredByFocus = false;\n\n  function enter() {\n    if (active) return;\n    if (options.enter) options.enter();\n    active = true;\n  }\n\n  function exit() {\n    if (!active) return;\n    clearTimeout(timeout);\n    if (options.exit) options.exit();\n    active = false;\n  }\n\n  $el.on('mouseover', () => {\n    if (options.preventMouseover && options.preventMouseover()) return;\n    clearTimeout(timeout);\n    timeout = delay(() => {\n      enter();\n      wasTriggeredByMouse = true;\n    }, options.delay);\n  });\n\n  $el.on('mouseout', () => {\n    if (!wasTriggeredByMouse) return;\n    clearTimeout(timeout);\n    timeout = delay(exit, options.exitDelay || options.delay);\n  });\n\n  $clickTarget.on('focus', () => {\n    if (active || options.preventMouseover && options.preventMouseover()) return;\n    clearTimeout(timeout);\n    enter();\n    wasTriggeredByFocus = true;\n  });\n\n  const onBlur = () => {\n    if (!wasTriggeredByFocus) return;\n\n    if (options.canFocusWithin) {\n      // Special handling if the blur of the $clickTarget was caused by focussing\n      // another child of $el (e.g. e <button> inside a popup).\n      // Timeout required so that the new element has focussed.\n      setTimeout(() => {\n        const $newActive = Browser.getActiveInput();\n        if ($newActive && $newActive.hasParent($el)) {\n          $newActive.one('blur', onBlur);\n        } else {\n          exit();\n        }\n      });\n    } else {\n      exit();\n    }\n  };\n  $clickTarget.on('blur', onBlur);\n\n  $clickTarget.on('click', () => {\n    if (active && (!wasTriggeredByMouse)) {\n      exit();\n    } else if (!active) {\n      enter();\n      wasTriggeredByMouse = false;\n    }\n  });\n\n  $el.on('clickOutside', exit);\n}\n\n\n// -----------------------------------------------------------------------------\n// Intersection Events\n\nlet observer: IntersectionObserver;\n\nfunction intersectionCallback(entries: IntersectionObserverEntry[]) {\n  for (const e of entries) {\n    const event = e.isIntersecting ? 'enterViewport' : 'exitViewport';\n    setTimeout(() => $(e.target)!.trigger(event));\n  }\n}\n\nfunction makeIntersectionEvents($el: ElementView) {\n  // TODO Support removing events.\n\n  if ($el._data['intersectionEvents']) return;\n  $el._data['intersectionEvents'] = true;\n\n  // Polyfill for window.IntersectionObserver\n  if (!window.IntersectionObserver) {\n    let wasVisible = false;\n    $body.on('scroll', () => {\n      const isVisible = $el.isInViewport;\n      if (wasVisible && !isVisible) {\n        $el.trigger('exitViewport');\n        wasVisible = false;\n      } else if (isVisible && !wasVisible) {\n        $el.trigger('enterViewport');\n        wasVisible = true;\n      }\n    });\n    return;\n  }\n\n  if (!observer) observer = new IntersectionObserver(intersectionCallback);\n  observer.observe($el._el);\n}\n\n\n// -----------------------------------------------------------------------------\n// Resize Events\n\nfunction makeResizeEvents($el: ElementView, remove = false) {\n  if (remove) {\n    if ($el._data['resizeObserver']) ($el._data['resizeObserver'] as ResizeObserver).disconnect();\n    $el._data['resizeObserver'] = undefined;\n  }\n\n  if ($el._data['resizeObserver']) return;\n\n  if (window.ResizeObserver) {\n    const observer = new window.ResizeObserver(() => $el.trigger('resize'));\n    observer.observe($el._el);\n    $el._data['resizeObserver'] = observer;\n\n  } else if (window.MutationObserver) {\n    const observer = new MutationObserver(() => $el.trigger('resize'));\n    observer.observe($el._el, {attributes: true, childList: true, characterData: true, subtree: true});\n    $el._data['resizeObserver'] = observer;\n  }\n}\n\n\n// -----------------------------------------------------------------------------\n// Pointer Events\n\nfunction makePointerPositionEvents($el: ElementView) {\n  // TODO Support removing events.\n\n  if ($el._data['pointerPositionEvents']) return;\n  $el._data['pointerPositionEvents'] = true;\n\n  const parent = $el.parent!;\n  let isInside: boolean|undefined;\n\n  parent.on('pointerend', () => (isInside = undefined));\n\n  parent.on('pointermove', (e: ScreenEvent) => {\n    const wasInside = isInside;\n    const target = getEventTarget(e)!;\n    isInside = target.equals($el) || target.hasParent($el);\n    if (wasInside !== undefined && isInside && !wasInside) $el.trigger('pointerenter', e);\n    if (!isInside && wasInside) $el.trigger('pointerleave', e);\n  });\n}\n\n\n// -----------------------------------------------------------------------------\n// Mouse Events\n// On touch devices, mouse events are emulated. We don't want that!\n\nfunction makeMouseEvent(eventName: string, $el: ElementView) {\n  // TODO Support removing events.\n\n  if ($el._data[`_${eventName}`]) return;\n  $el._data[`_${eventName}`] = true;\n\n  if (pointerSupport) {\n    $el.on(eventName.replace('mouse', 'pointer'), (e) => {\n      if (e.pointerType === 'mouse') $el.trigger(eventName, e);\n    });\n  } else if (!touchSupport) {\n    $el._el.addEventListener(eventName, (e) => $el.trigger(eventName, e));\n  }\n}\n\n\n// -----------------------------------------------------------------------------\n// Keyboard Events\n\nfunction makeKeyEvent($el: ElementView) {\n  // On Android, the keydown event always returns character 229, except for the\n  // backspace button which works as expected. Instead, we have to listen to the\n  // input event and get the last character of the typed text. Note that this\n  // only works if the cursor is at the end, or if the input field gets cleared\n  // after every key.\n\n  // Note that e.keyCode is deprecated, but iOS doesn't support e.key yet.\n\n  $el.on('keydown', (e: KeyboardEvent) => {\n    if (e.metaKey || e.ctrlKey) return;\n    if (Browser.isAndroid && e.keyCode === 229) return;\n\n    const key = e.key || String.fromCharCode(e.which);\n    const shift = !!e.shiftKey;\n    $el.trigger('key', {code: e.keyCode, key, char: key, shift});\n  });\n\n  if (Browser.isAndroid && $el.type === 'input') {\n    $el.on('input', (e) => {\n      const key = e.key || e.data[e.data.length - 1];\n      $el.trigger('key', {code: undefined, key, char: key});\n      ($el as InputView).value = '';\n    });\n  }\n}\n\n\n// -----------------------------------------------------------------------------\n// Event Creation\n\nconst aliases: Obj<string> = {\n  scrollwheel: 'DOMMouseScroll mousewheel',\n  pointerdown: pointerSupport ? 'pointerdown' :\n    touchSupport ? 'touchstart' : 'mousedown',\n  pointermove: pointerSupport ? 'pointermove' :\n    touchSupport ? 'touchmove' : 'mousemove',\n  pointerup: pointerSupport ? 'pointerup' :\n    touchSupport ? 'touchend' : 'mouseup',\n  pointercancel: pointerSupport ? 'pointercancel' : 'touchcancel',\n  pointerstop: pointerSupport ? 'pointerup pointercancel' :\n    touchSupport ? 'touchend touchcancel' : 'mouseup'\n};\n\nconst customEvents: Obj<($el: ElementView, remove: boolean) => void> = {\n  scroll: makeScrollEvents,\n  tap: makeTapEvent,\n  clickOutside: makeClickOutsideEvent,\n  key: makeKeyEvent,\n\n  mousedown: makeMouseEvent.bind(undefined, 'mousedown'),\n  mousemove: makeMouseEvent.bind(undefined, 'mousemove'),\n  mouseup: makeMouseEvent.bind(undefined, 'mouseup'),\n\n  pointerenter: makePointerPositionEvents,\n  pointerleave: makePointerPositionEvents,\n\n  enterViewport: makeIntersectionEvents,\n  exitViewport: makeIntersectionEvents,\n  resize: makeResizeEvents\n};\n\nexport function bindEvent($el: ElementView, event: string, fn: EventCallback,\n  options?: EventListenerOptions) {\n  if (event in customEvents) {\n    customEvents[event]($el, false);\n  } else if (event in aliases) {\n    const events = words(aliases[event]);\n    // Note that the mouse event aliases don't pass through makeMouseEvent()!\n    for (const e of events) $el._el.addEventListener(e, fn, options);\n  } else {\n    $el._el.addEventListener(event, fn, options);\n  }\n}\n\nexport function unbindEvent($el: ElementView, event: string,\n  fn?: EventCallback) {\n\n  if (event in customEvents) {\n    if (!$el._events[event] || !$el._events[event].length) {\n      // Remove custom events only when there are no more listeners.\n      customEvents[event]($el, true);\n    }\n  } else if (fn && event in aliases) {\n    const events = words(aliases[event]);\n    for (const e of events) $el._el.removeEventListener(e, fn);\n  } else if (fn) {\n    $el._el.removeEventListener(event, fn);\n  }\n}\n", "// =============================================================================\n// Boost.js | Observable\n// (c) Mathigon\n// =============================================================================\n\n\ntype Callback<T> = (state: T, initial?: boolean) => void;\ntype Expr<T> = (state: T) => void;\n\ninterface ObservableOptions<T> {\n  watch: (fn: Callback<T>) => void;\n  unwatch: (fn: Callback<T>) => void;\n  watchAll: (fn: Callback<T>, dontRunImmediately?: boolean) => void;\n  setComputed: (key: string, expr: (state: T) => unknown) => void;\n  forceUpdate: () => void;\n  assign: (obj: Partial<T>, clear?: boolean) => void;\n  getChanges: () => [Partial<T>, Partial<T>];\n  getKey: () => string;\n  clear: () => void;\n  copy: () => T;\n}\n\nexport type Observable<T = any> = T&ObservableOptions<T>;\n\n\nlet batchDepth = 0;\nconst batchedCallbacks = new Map<Callback<any>, Observable>();\n\nfunction enqueueCallback(callback: Callback<any>, state: Observable) {\n  batchedCallbacks.set(callback, state);\n}\n\n/** Batch multiple observable changes together into a single callback. */\nexport function batch(callback: () => void) {\n  batchDepth++;\n  callback();\n  batchDepth--;\n  if (batchDepth === 0) {\n    for (const [callback, state] of batchedCallbacks.entries()) callback(state);\n    batchedCallbacks.clear();\n  }\n}\n\n\n/** Convert object to an observable Proxy with .watch() callbacks. */\nexport function observe<T extends object = any>(state: T, parentModel?: Observable) {\n  const callbackMap = new Map<string, Set<Callback<T>>>();\n  const computedKeys = new Map<string, Callback<T>>();\n  const watchAllCallbacks = new Set<Callback<T>>();\n  let pendingCallback: Callback<T>|undefined = undefined;\n  let lastKey = 0;\n\n  function watch(callback: Callback<T>) {\n    pendingCallback = callback;\n    const result = callback(proxy, true);\n    pendingCallback = undefined;\n    return result;\n  }\n\n  function unwatch(callback: Callback<T>) {\n    for (const callbacks of callbackMap.values()) {\n      if (callbacks.has(callback)) callbacks.delete(callback);\n    }\n    watchAllCallbacks.delete(callback);\n  }\n\n  function watchAll(callback: Callback<T>, dontRun?: boolean) {\n    watchAllCallbacks.add(callback);\n    return dontRun ? undefined : callback(proxy, true);\n  }\n\n  function setComputed(key: string, expr: Expr<T>) {\n    if (computedKeys.has(key)) unwatch(computedKeys.get(key)!);\n\n    const callback = () => {\n      (state as any)[key] = expr(proxy);\n      if (pendingCallback === callback) pendingCallback = undefined;  // why?\n      triggerCallbacks(key);\n    };\n\n    computedKeys.set(key, callback);\n    watch(callback);\n  }\n\n  function triggerCallbacks(key: string) {\n    if (batchDepth > 0) {\n      for (const callback of callbackMap.get(key) || []) enqueueCallback(callback, state);\n      for (const callback of watchAllCallbacks) enqueueCallback(callback, state);\n    } else {\n      for (const callback of callbackMap.get(key) || []) callback(state);\n      for (const callback of watchAllCallbacks) callback(state);\n    }\n  }\n\n  function forceUpdate() {\n    for (const callbacks of callbackMap.values()) {\n      for (const callback of callbacks) callback(state);\n    }\n    for (const callback of watchAllCallbacks) callback(state);\n  }\n\n  function assign(changes: Partial<T>, clear?: boolean) {\n    if (clear) state = {} as T;\n    batch(() => {\n      for (const [key, value] of Object.entries(changes)) {\n        if (!(key in previous)) (previous as any)[key] = (state as any)[key];\n        proxy[key] = value;\n      }\n    });\n  }\n\n  function getKey() {\n    lastKey += 1;\n    while (`_x${lastKey}` in state) lastKey += 1;\n    return `_x${lastKey}`;\n  }\n\n  function clear() {\n    state = {} as T;\n    callbackMap.clear();\n    computedKeys.clear();\n    lastKey = 0;\n  }\n\n  function copy() {\n    return Object.assign({}, state);\n  }\n\n  let previous: Partial<T> = {};\n  function getChanges() {\n    const changes: [Partial<T>, Partial<T>] = [{}, {}];\n    for (const k of Object.keys(previous)) {\n      if ((previous as any)[k] === (state as any)[k]) continue;\n      (changes[0] as any)[k] = (previous as any)[k];\n      (changes[1] as any)[k] = (state as any)[k];\n    }\n    previous = {};\n    return changes;\n  }\n\n  /**\n   * Allow this model to \"inherit\" properties from a parent model, and update\n   * it when the parent model changes.\n   */\n  function inherit(key: string) {\n    if (!parentModel) return;\n    parentModel.watch(() => (proxy[key] = parentModel[key]));\n  }\n\n  const proxy = new Proxy(state as any, {\n    get(_: T, key: string) {\n      if (key === 'watch') return watch;\n      if (key === 'unwatch') return unwatch;\n      if (key === 'watchAll') return watchAll;\n      if (key === 'setComputed') return setComputed;\n      if (key === 'forceUpdate') return forceUpdate;\n      if (key === 'getChanges') return getChanges;\n      if (key === 'assign') return assign;\n      if (key === 'getKey') return getKey;\n      if (key === 'clear') return clear;\n      if (key === 'copy') return copy;\n      if (key === '_internal') return [state, callbackMap];\n\n      // A callback is currently being run. We track its dependencies.\n      if (pendingCallback) {\n        if (!callbackMap.has(key)) callbackMap.set(key, new Set());\n        callbackMap.get(key)!.add(pendingCallback);\n      }\n\n      if (!(key in state)) inherit(key);\n      return (state as any)[key];\n    },\n\n    set(_: T, key: string, value: any) {\n      if ((state as any)[key] === value) return true;\n      if (!(key in previous)) (previous as any)[key] = (state as any)[key];\n      (state as any)[key] = value;\n\n      // Clear a value that was previously computed.\n      // TODO Clear properties that were inherited from parent modal.\n      if (computedKeys.has(key)) {\n        unwatch(computedKeys.get(key)!);\n        computedKeys.delete(key);\n      }\n\n      triggerCallbacks(key);\n      return true;\n    },\n\n    deleteProperty(_: T, p: string) {\n      delete (state as any)[p];\n      callbackMap.delete(p);\n      computedKeys.delete(p);\n      return true;\n    }\n  });\n\n  return proxy as Observable<T>;\n}\n", "// =============================================================================\n// Boost.js | SVG Drawing\n// (c) Mathigon\n// =============================================================================\n\n\nimport {chunk, last} from '@mathigon/core';\nimport {Point} from '@mathigon/euclid';\n\n\nexport type PathCommand = {points: Point[], type?: string, options?: number[]};\n\nconst pathLength: Record<string, number> = {A: 7, C: 6, H: 1, L: 2, M: 2, Q: 4, S: 4, T: 2, V: 1, Z: 0};\nconst pathSegment = /[astvzqmhlc]([^astvzqmhlc]*)/ig;\nconst pathPoint = /-?[0-9]*\\.?[0-9]+(?:e[-+]?\\d+)?/ig;\n\n\nexport function pathCommands(path: string): PathCommand[] {\n  const commands: PathCommand[] = [];\n  let lastPoint: Point|undefined = undefined;\n\n  for (const match of (path.match(pathSegment) || [])) {\n    const uType = match[0].toUpperCase();\n\n    if (uType === 'Z') {\n      commands.push({type: 'Z', points: []});\n      continue;\n    }\n\n    const args = (match.slice(1).match(pathPoint) || []).map((p: string) => +p);\n    const isAbsolute = uType === match[0];\n\n    for (const [i, p] of chunk<number>(args, pathLength[uType]).entries()) {\n      let points: Point[] = [];\n      let type = (uType === 'M' && i > 0) ? 'L' : uType;\n      let options: number[]|undefined = undefined;\n\n      if (uType === 'H') {\n        type = 'L';\n        points = [new Point(p[0], isAbsolute ? (lastPoint?.y || 0) : 0)];\n      } else if (uType === 'V') {\n        type = 'L';\n        points = [new Point(isAbsolute ? (lastPoint?.x || 0) : 0, p[0])];\n      } else if (uType === 'A') {\n        type = 'A';\n        points = [new Point(p[5], p[6])];\n        options = p.slice(0, 5);\n      } else if ('MLCSQT'.includes(uType)) {\n        points = chunk(p, 2).map(q => new Point(q[0], q[1]));\n      }\n\n      if (!isAbsolute && lastPoint) points = points.map(p => p.translate(lastPoint!));\n      lastPoint = last(points);\n      commands.push({type, points, options});\n    }\n  }\n\n  return commands;\n}\n\n/**\n * Return all points on an SVG path. Essentially, this turns a curved path into\n * a polygon with just the joins/corners selected.\n */\nexport function parsePath(d: string): Point[] {\n  if (!d) return [];\n  const commands = pathCommands(d);\n  return commands.map(c => last(c.points)).filter(p => !!p);\n}\n\n\n// -----------------------------------------------------------------------------\n// Nicer SVG exporting\n\nconst COMMON_STYLES = ['font-family', 'font-size', 'font-style', 'font-weight',\n  'letter-spacing', 'text-decoration', 'color', 'display', 'visibility',\n  'alignment-baseline', 'baseline-shift', 'opacity', 'text-anchor', 'clip',\n  'clip-path', 'clip-rule', 'mask', 'filter', 'transform', 'transform-origin',\n  'white-space', 'line-height'];\n\nconst SVG_STYLES = ['fill', 'fill-rule', 'marker', 'marker-start', 'marker-mid',\n  'marker-end', 'stroke', 'stroke-dasharray', 'stroke-dashoffset',\n  'stroke-linecap', 'stroke-linejoin', 'stroke-width', 'text-rendering',\n  'dominant-baseline', 'transform-box', 'paint-order'];\n\nconst HTML_STYLES = ['padding', 'min-width', 'max-width', 'height',\n  'border-width', 'border-style', 'border-color', 'box-sizing', 'background',\n  'width', 'grid-template-columns', 'text-align'];\n\nconst REMOVE_ATTRIBUTES = ['class', 'tabindex', 'contenteditable'];\n\nconst DONT_INHERIT = new Set(['opacity', 'transform-box', 'transform-origin', 'border-width', 'border-style', 'border-color']);\n\nconst STYLE_DEFAULTS: Record<string, string> = {\n  'font-style': 'normal',\n  'font-weight': '400',\n  'letter-spacing': 'normal',\n  'text-decoration': 'none',\n  'display': 'block',\n  'visibility': 'visible',\n  'alignment-baseline': 'auto',\n  'baseline-shift': '0px',\n  'text-anchor': 'start',\n  'clip': 'auto',\n  'clip-path': 'none',\n  'clip-rule': 'nonzero',\n  'mask': 'none',\n  'opacity': '1',\n  'filter': 'none',\n  'fill': 'rgb(0, 0, 0)',\n  'fill-rule': 'nonzero',\n  'marker': 'none',\n  'stroke': 'none',\n  'stroke-dasharray': 'none',\n  'stroke-dashoffset': '0px',\n  'stroke-linecap': 'butt',\n  'stroke-linejoin': 'miter',\n  'stroke-width': '1px',\n  'text-rendering': 'auto',\n  'transform': 'none',\n  'dominant-baseline': 'auto',\n  'transform-origin': '0px 0px',\n  'transform-box': 'view-box',\n  'paint-order': 'normal'\n};\n\ntype El = HTMLElement|SVGElement;\n\nexport function cleanSVG(node: El) {\n  if (node.getAttribute('hidden') || node.style.opacity === '0' || node.style.display === 'none') {\n    // The element is hidden, so remove entirely.\n    node.parentNode?.removeChild(node);\n  } else {\n    // Clean all child elements\n    for (const child of Array.from(node.children)) cleanSVG(child as El);\n    if (node.tagName === 'g' && node.childElementCount === 0) {\n      // If there are no more child elements of this group, remove, too.\n      node.parentNode?.removeChild(node);\n    } else {\n      // Otherwise, clean attributes.\n      for (const a of REMOVE_ATTRIBUTES) {\n        if (node.hasAttribute(a)) node.removeAttribute(a);\n      }\n    }\n  }\n}\n\nfunction inheritedStyle(node: El, prop: string) {\n  let n = node.parentElement;\n  while (n) {\n    const value = n.style.getPropertyValue(prop);\n    if (value) return value;\n    n = n.parentElement;\n  }\n}\n\nexport function copySVGStyles(source: El, copy: El, isHTML = false) {\n  const style = window.getComputedStyle(source);\n  copy.removeAttribute('style');  // Clean up previous values.\n\n  const html = isHTML || (source.tagName === 'foreignObject');\n  const properties = [...COMMON_STYLES, ...(html ? HTML_STYLES : SVG_STYLES)];\n\n  // TODO Fix transform-origin and transform-box for compass and playing cards.\n  for (const p of properties) {\n    const value = style.getPropertyValue(p);\n    const inherited = inheritedStyle(copy, p);\n    if (value === STYLE_DEFAULTS[p] && !inherited) continue;  // This property is a default.\n    if (!DONT_INHERIT.has(p) && value === inherited) continue;  // This property is inherited.\n    copy.style.setProperty(p, value);\n  }\n\n  const sourceChildren = source.children;\n  const copyChildren = copy.children;\n  for (let i = 0; i < copyChildren.length; ++i) {\n    copySVGStyles(sourceChildren[i] as El, copyChildren[i] as El, html);\n  }\n}\n", "// =============================================================================\n// Audio Tools\n// (c) Mathigon\n// =============================================================================\n\n\nexport class AudioPlayer {\n  private player = new Audio();\n\n  constructor(public src: string, public defaultVolume = 1, preload = true) {\n    this.player.src = src;\n    if (preload) this.player.preload = 'auto';\n  }\n\n  play(volume?: number) {\n    this.player.currentTime = 0;\n    this.player.volume = volume || this.defaultVolume;\n    this.player.play();\n  }\n}\n", "// =============================================================================\n// Boost.js | Confetti Generator\n// (c) Mathigon\n// =============================================================================\n\n\nimport {loop, tabulate} from '@mathigon/core';\nimport {Random} from '@mathigon/fermat';\nimport {$body, $N, CanvasView} from './elements';\nimport {animate} from './animate';\nimport {Browser} from './browser';\n\nconst colours = loop(['#cd0e66', '#0f82f2', '#22ab24', '#fd8c00']);\n\n\nclass Particle {\n  private color = colours();\n  private tilt = Math.floor(Math.random() * 10) - 10;\n  private tiltAngleIncrement = (Math.random() * 0.07) + .05;\n  private tiltAngle = 0;\n\n  x = Math.random() * Browser.width;\n  y = (Math.random() - 1) * Browser.height;\n  r = Random.uniform(10, 30);\n\n  constructor(private index: number) { }\n\n  draw(ctx: CanvasRenderingContext2D) {\n    ctx.beginPath();\n    ctx.lineWidth = this.r / 2;\n    ctx.strokeStyle = this.color;\n    ctx.moveTo(this.x + this.tilt + (this.r / 4), this.y);\n    ctx.lineTo(this.x + this.tilt, this.y + this.tilt + (this.r / 4));\n    ctx.stroke();\n  }\n\n  update(t: number, loop: boolean) {\n    this.tiltAngle += this.tiltAngleIncrement;\n\n    this.y += (Math.cos(t) + 3 + this.r / 2) / 2;\n    this.x += Math.sin(t);\n    this.tilt = (Math.sin(this.tiltAngle - (this.index / 3))) * 15;\n\n    if (this.x < -20) {\n      this.x = -20;\n      this.y = Math.random() * Browser.height;\n      this.tilt = Math.floor(Math.random() * 10) - 20;\n\n    } else if (this.x > Browser.width + 20) {\n      this.x = Browser.width + 20;\n      this.y = Math.random() * Browser.height;\n      this.tilt = Math.floor(Math.random() * 10) - 20;\n\n    } else if (loop && this.y > Browser.height) {\n      this.x = Math.random() * Browser.width;\n      this.y = -10;\n      this.tilt = Math.floor(Math.random() * 10) - 20;\n    }\n  }\n}\n\n// -----------------------------------------------------------------------------\n\nconst style = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999';\nlet $confetti: CanvasView|undefined = undefined;\n\nexport function confetti(duration = 2000, maxParticles = 150) {\n  if (!$confetti) $confetti = $N('canvas', {style}, $body) as CanvasView;\n  $confetti.setAttr('width', Browser.width);\n  $confetti.setAttr('height', Browser.height);\n  $confetti.show();\n\n  const context = $confetti.ctx;\n  const particles = tabulate(i => new Particle(i), maxParticles);\n\n  const animation = animate(t => {\n    context.clearRect(0, 0, Browser.width, Browser.height);\n\n    const loop = t < duration;\n    let visible = 0;\n\n    for (const p of particles) {\n      p.draw(context);\n      p.update(t, loop);\n      if (p.y < Browser.height) visible += 1;\n    }\n\n    if (!visible) {\n      animation.cancel();\n      $confetti!.hide();\n    }\n  });\n}\n", "// =============================================================================\n// Boost.js | Draggable Component\n// (c) Mathigon\n// =============================================================================\n\n\nimport {EventTarget} from '@mathigon/core';\nimport {Bounds, Point} from '@mathigon/euclid';\nimport {animate} from './animate';\nimport {$html, ElementView, SVGParentView} from './elements';\nimport {Browser} from './browser';\nimport {slide} from './events';\n\n\ninterface DraggableOptions {\n  /** The container within which this element is being dragged. */\n  $parent?: ElementView;\n  /** Whether to constrain the elements to within the bounds of $parent. */\n  withinBounds?: boolean;\n  /** Whether it is draggable along the x-axis. */\n  moveX?: boolean;\n  /** Whether it is draggable along the y-axis. */\n  moveY?: boolean;\n  /** Interval for snapping (in px) */\n  snap?: number;\n  /** Whether to use CSS transforms rather than `left` and `right`. */\n  useTransform?: boolean;\n  /** Margin within the `$parent` element. */\n  margin?: number;\n  /** Custom rounding function. */\n  round?: ((p: Point) => Point);\n  /** Custom bounds within which the element is draggable. */\n  bounds?: Bounds;\n  /** Whether to reset position when dropped outside of a target */\n  resetOnMiss?: boolean;\n  /** Elements that the Draggable instance can be dropped onto */\n  $targets?: ElementView[];\n}\n\n\n/**\n * A draggable and droppable HTML element.\n * @emits Draggable#click - Fired when the user clicks on this element.\n * @emits Draggable#start - Fired when the user starts dragging.\n * @emits Draggable#drag {posn: Point, pointerPosn: Point} - Fired while the user is dragging.\n * @emits Draggable#move {posn: Point} - Fired when the position of this element changes.\n * @emits Draggable#end {$target?: ElementView} - Fired after the user stops dragging this element, including the current `$target` which may be undefined.\n * @emits Draggable#enter-target {$target: ElementView} - Fired when the pointer enters the bounds of a `$target` element while dragging\n * @emits Draggable#exit-target {$target: ElementView} - Fired when the pointer exists the bounds of a `$target` element while dragging\n */\nexport class Draggable extends EventTarget {\n  protected options: DraggableOptions;\n  private startPos = new Point(0, 0);\n  private $over?: ElementView;\n  position = new Point(0, 0);\n  disabled = false;\n  bounds?: Bounds;\n\n  constructor(readonly $el: ElementView, options: DraggableOptions = {}) {\n    super();\n\n    this.options = Object.assign({moveX: true, moveY: true, withinBounds: true}, options);\n    Browser.onResize(() => this.updateBounds());\n\n    slide($el, {\n      start: () => {\n        if (this.disabled) return;\n        this.startPos = this.position;\n        this.trigger('start');\n        $html.addClass('grabbing');\n      },\n      move: (posn, start) => {\n        if (this.disabled) return;\n        this.setPosition(this.startPos.x + posn.x - start.x, this.startPos.y + posn.y - start.y);\n        this.trigger('drag', {posn: this.position, pointerPosn: posn});\n        this.checkTarget(posn);\n      },\n      end: (last, start) => {\n        if (this.disabled) return;\n        this.trigger(last.equals(start) ? 'click' : 'end', {$target: this.$over});\n        if (this.options.$targets && !this.$over && this.options.resetOnMiss) this.resetPosition();\n        this.$over = undefined;\n        $html.removeClass('grabbing');\n      },\n      click: () => this.trigger('click'),\n      accessible: true\n    });\n  }\n\n\n  // ---------------------------------------------------------------------------\n  // Target drag-n-drop\n\n  addTarget($target: ElementView) {\n    if (!this.options.$targets) this.options.$targets = [];\n    this.options.$targets?.push($target);\n  }\n\n  removeTarget($target: ElementView) {\n    this.options.$targets = this.options.$targets?.filter($el => $el !== $target);\n    if (!this.options.$targets?.length) this.options.$targets = undefined;\n  }\n\n  private checkTarget(posn: Point) {\n    if (!this.options.$targets) return;\n\n    const $target = this.options.$targets.find($t => $t.boundsRect.contains(posn));\n    if ($target === this.$over) return;\n\n    if (this.$over) this.trigger('exit-target', {$target: this.$over});\n    if ($target) this.trigger('enter-target', {$target});\n\n    this.$over = $target;\n  }\n\n\n  // ---------------------------------------------------------------------------\n  // Resizing and positioning\n\n  private updateBounds() {\n    if (!this.options.withinBounds) return (this.bounds = undefined);\n    if (this.options.bounds) return (this.bounds = this.options.bounds);\n\n    const oldBounds = this.bounds;\n    const $parent = this.options.$parent || this.$el.parent!;\n\n    const width = ($parent.type === 'svg') ? ($parent as SVGParentView).svgWidth : $parent.width;\n    const height = ($parent.type === 'svg') ? ($parent as SVGParentView).svgHeight : $parent.height;\n    this.bounds = new Bounds(0, width, 0, height);\n\n    // Fallback in case the element is not yet visible...\n    if (!width && !height) setTimeout(() => this.updateBounds());\n\n    if (oldBounds) {\n      // Proportionally reposition the draggable element\n      this.setPosition(this.position.x * this.bounds.dx / oldBounds.dx || 0,\n        this.position.y * this.bounds.dy / oldBounds.dy || 0);\n    }\n  }\n\n  /** Sets the position of the element. */\n  setPosition(x: number, y: number) {\n    let p = new Point(this.options.moveX ? x : 0, this.options.moveY ? y : 0);\n    if (this.bounds) p = p.clamp(this.bounds, this.options.margin ?? 0);\n    p = p.round(this.options.snap || 1);\n    if (this.options.round) p = this.options.round(p);\n\n    if (p.equals(this.position)) return;\n    this.position = p;\n\n    if (this.options.useTransform) {\n      this.$el.translate(p.x, p.y);\n    } else {\n      if (this.options.moveX) this.$el.css('left', `${p.x}px`);\n      if (this.options.moveY) this.$el.css('top', `${p.y}px`);\n    }\n\n    this.trigger('move', {posn: p});\n  }\n\n  async resetPosition(duration = 250) {\n    const initial = this.position;\n    this.$el.css({'pointer-events': 'none'});\n    await animate((p: number) => {\n      const currentPos = Point.interpolate(initial, this.startPos, p);\n      this.setPosition(currentPos.x, currentPos.y);\n    }, duration).promise;\n    this.$el.css({'pointer-events': 'initial'});\n  }\n}\n", "// =============================================================================\n// Boost.js | Router\n// (c) Mathigon\n// =============================================================================\n\n\nimport {EventTarget, Obj} from '@mathigon/core';\nimport {animate, AnimationResponse} from './animate';\nimport {Browser, replaceSvgImports} from './browser';\nimport {$body, $N, ElementView} from './elements';\n\n\ndeclare global {\n  interface Window {\n    ga?: any;  // Google Analytics Object\n    gtag?: any;  // Google Analytics Object\n  }\n}\n\nconst LOADING_STYLE = 'position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: #0f82f2; pointer-events: none; z-index: 9999; will-change: transform;';\n\ntype Callback = ($el: ElementView, params: ViewParams) => void;\n\ninterface RouterOptions {\n  $viewport?: ElementView;\n  preloaded?: boolean;\n  transition?: boolean;\n  initialise?: Callback;\n  noLoad?: boolean;\n  click?: boolean;\n  history?: boolean;\n}\n\ntype ViewParams = Obj<string>;\n\ninterface ViewOptions {\n  enter?: Callback;\n  exit?: () => void;\n  template?: string|((params: ViewParams) => string|Promise<string>);\n}\n\ninterface View extends ViewOptions {\n  regex: RegExp;\n  params: string[];\n}\n\nfunction getViewParams(url: string, view: View): ViewParams|undefined {\n  const match = view.regex.exec(url);\n  if (match) {\n    match.shift();\n    const params: ViewParams = {};\n    for (const [i, p] of view.params.entries()) params[p] = match[i];\n    return params;\n  } else {\n    return undefined;\n  }\n}\n\nasync function getTemplate(view: View, params: ViewParams, url: string): Promise<string> {\n  if (view.template) {\n    if (typeof view.template === 'string') return view.template;\n    return view.template(params);\n  }\n\n  // Append a query string to only load the body of the page, not the header.\n  const str = await fetch(url + (url.indexOf('?') >= 0 ? '&xhr=1' : '?xhr=1'));\n  return str.text();\n}\n\n// Don't trigger Router events during the initial Page load.\nlet isReady = (document.readyState === 'complete');\nwindow.addEventListener('load', () => setTimeout(() => (isReady = true)));\n\n// Prevent scroll restoration on popstate\nif ('scrollRestoration' in window.history) {\n  window.history.scrollRestoration = 'manual';\n}\n\n\n// -----------------------------------------------------------------------------\n// Router Cla\n\nclass Router extends EventTarget {\n  private $viewport: ElementView = $body;\n  private views: View[] = [];\n\n  private active = {path: '', hash: ''};\n\n  private preloaded = false;\n  private transition = false;\n  private noLoad = false;\n  private initialise: Callback = () => undefined;\n  beforeChange?: () => Promise<boolean>;\n\n  setup(options: RouterOptions = {}) {\n    if (options.$viewport) this.$viewport = options.$viewport;\n    if (options.initialise) this.initialise = options.initialise;\n    if (options.preloaded) this.preloaded = options.preloaded;\n    if (options.transition) this.transition = options.transition;\n    if (options.noLoad) this.noLoad = options.noLoad;\n\n    if (options.click) {\n      $body.on('click', (e: MouseEvent) => this.onLinkClick(e));\n    }\n\n    if (options.history) {\n      window.addEventListener('popstate', async (e: PopStateEvent) => {\n        if (!isReady || !e.state?.path) return;\n        const success = await this.load(e.state.path, e.state.hash);\n        // Manually revert to the previous state, since popstate events are non-cancellable.\n        if (!success) window.history.pushState(this.active, '', this.active.path + this.active.hash);\n      });\n    }\n  }\n\n  view(url: string, {enter, exit, template}: ViewOptions = {}) {\n    const params = (url.match(/:\\w+/g) || []).map(x => x.substr(1));\n    const regexStr = `${url.replace(/:\\w+/g, '([\\\\w-]+)').replace('/', '\\\\/')}\\\\/?`;\n    const searchStr = url.includes('?') ? '' : '(\\\\?.*)?';\n    const regex = new RegExp(`^${regexStr}${searchStr}$`, 'i');\n\n    const thisView = {regex, params, enter, exit, template};\n    this.views.push(thisView);\n\n    const current = window.location.pathname + window.location.search;\n    const viewParams = getViewParams(current, thisView);\n    if (!viewParams) return;\n\n    this.active = {path: current, hash: window.location.hash};\n    window.history.replaceState(this.active, '', this.active.path + this.active.hash);\n\n    // The wrappers fix stupid Firefox, which doesn't seem to take its time\n    // triggering .createdCallbacks for web components...\n    Browser.ready(() => {\n      setTimeout(() => {\n        if (this.preloaded) {\n          this.initialise(this.$viewport, viewParams);\n          if (thisView.enter) thisView.enter(this.$viewport, viewParams);\n        } else {\n          this.loadView(thisView, viewParams);\n        }\n      });\n    });\n  }\n\n  paths(...urls: string[]) {\n    for (const url of urls) this.view(url);\n  }\n\n  private getView(path: string) {\n    for (const view of this.views) {\n      const params = getViewParams(path, view);\n      if (params) return {view, params};\n    }\n  }\n\n\n  // ---------------------------------------------------------------------------\n  // Loading and Rendering\n\n  private async load(path: string, hash: string) {\n    if (path === this.active.path && hash !== this.active.hash) {\n      this.trigger('hashChange', hash.slice(1));\n      this.trigger('change', path + hash);\n      this.active = {path, hash};\n      return true;\n    }\n\n    const go = this.getView(path);\n    if (!go) return false;\n\n    if (this.beforeChange && !(await this.beforeChange())) return false;\n    this.active = {path, hash};\n\n    this.trigger('change', path + hash);\n    if (window.ga) window.ga('send', 'pageview', path + hash);\n    if (this.noLoad) {\n      if (go.view.enter) go.view.enter(this.$viewport, go.params);\n    } else {\n      this.loadView(go.view, go.params);  // async\n    }\n\n    return true;\n  }\n\n  private async loadView(view: View, params: ViewParams = {}) {\n    this.showLoadingBar();\n\n    const path = this.active.path;\n    const template = await getTemplate(view, params, path);\n    if (this.active.path !== path) return;  // Navigated during load..\n\n    // TODO Remove all event listeners in $viewport, to avoid memory leaks.\n    await this.$viewport.animate({opacity: 0}, 200).promise;\n    this.$viewport.removeChildren();\n\n    $body.scrollTop = 0;\n    this.$viewport.html = template;\n    Browser.resize();\n    replaceSvgImports();\n    this.$viewport.animate({'opacity': 1}, 200);  // async\n    this.hideLoadingBar();\n\n    const $title = this.$viewport.$('title');\n    if ($title) document.title = $title.text;\n\n    this.initialise(this.$viewport, params);\n    if (view.enter) view.enter(this.$viewport, params);\n    this.trigger('afterChange', {$viewport: this.$viewport});\n  }\n\n\n  // ---------------------------------------------------------------------------\n  // Navigation Functions\n\n  private onLinkClick(e: MouseEvent) {\n    if (e.metaKey || e.ctrlKey || e.shiftKey) return;\n    if (e.defaultPrevented) return;\n\n    let el = e.target as Node;\n    while (el && el.nodeName !== 'A') el = el.parentNode!;\n    if (!el || el.nodeName !== 'A') return;\n\n    const anchor = el as HTMLAnchorElement;\n\n    // Check target\n    if (anchor.target) return;\n\n    // Different origin\n    if (anchor.origin !== window.location.origin) return;\n\n    // Ignore if tag has \"download\" attribute or rel=\"external\" attribute\n    if (anchor.hasAttribute('download') || anchor.getAttribute('rel') ===\n        'external') return;\n\n    // Check for mailto: in the href\n    const link = anchor.getAttribute('href');\n    if (link && link.indexOf('mailto:') > -1) return;\n\n    if (this.getView(anchor.pathname + anchor.search)) {\n      e.preventDefault();  // Only prevent default of the view exists.\n      this.goTo(anchor.pathname + anchor.search, anchor.hash);\n    }\n  }\n\n  async goTo(path: string, hash = '') {\n    const current = this.active.path + this.active.hash;\n    const success = await this.load(path, hash);\n    if (success && current !== this.active.path + this.active.hash) {\n      // If the path is the same, we don't push another state.\n      window.history.pushState(this.active, '', path + hash);\n    }\n  }\n\n  replace(path: string, hash = '') {\n    this.active = {path, hash};\n    window.history.replaceState(this.active, '', path + hash);\n  }\n\n  back() {\n    window.history.back();\n  }\n\n  forward() {\n    window.history.forward();\n  }\n\n\n  // ---------------------------------------------------------------------------\n  // Loading Bar\n\n  private animation?: AnimationResponse;\n  private $loadingBar?: ElementView;\n\n  showLoadingBar() {\n    if (!this.$loadingBar) this.$loadingBar = $N('div', {style: LOADING_STYLE}, $body);\n    this.$loadingBar.css({transform: 'translateX(-100%)', opacity: 1});\n    this.$loadingBar.show();\n\n    this.animation = animate((p) => {\n      this.$loadingBar!.css('transform', `translateX(-${10 + 90 * Math.exp(-4 * p)}%)`);\n    }, 3000);\n  }\n\n  async hideLoadingBar() {\n    this.animation?.cancel();\n    await this.$loadingBar?.animate({transform: 'none', opacity: 0}).promise;\n    this.$loadingBar?.hide();\n  }\n}\n\nexport const RouterInstance = new Router();\n", "// =============================================================================\n// Boost.js | Thread Class Functions\n// (c) Mathigon\n// =============================================================================\n\n\nimport {defer} from '@mathigon/core';\n\n\n/**\n * Converts a function into a WebWorker URL object that can be passed into\n * thread(). Note that `fn` has to be a single function with no external\n * references or bindings, so that it can be stringified using .toString().\n */\nexport function functionToWorker(fn: () => unknown) {\n  const content = `onmessage = e => postMessage((${fn.toString()})(e.data))`;\n  const blob = new Blob([content], {type: 'application/javascript'});\n  return URL.createObjectURL(blob);\n}\n\n\n/**\n * Creates a new web worker, posts it a serializable data object, and returns\n * when the worker responds (or after a fixed timeout).\n */\nexport function thread<T = unknown>(url: string|URL, data: unknown, timeout = 5000) {\n  const deferred = defer<T>();\n  const worker = new Worker(url);\n\n  const t = setTimeout(() => {\n    worker.terminate();\n    console.error('WebWorker timeout!');\n    deferred.reject();\n  }, timeout);\n\n  worker.onmessage = (e: MessageEvent) => {\n    clearTimeout(t);\n    worker.terminate();\n    console.log(e);\n    deferred.resolve(e.data);\n  };\n\n  worker.onerror = (e: ErrorEvent) => {\n    clearTimeout(t);\n    console.error('WebWorker error!', e);\n    worker.terminate();\n    deferred.reject(e);\n  };\n\n  worker.postMessage(data);\n  return deferred.promise;\n}\n", "// =============================================================================\n// Boost.js | Custom Elements Framework\n// (c) Mathigon\n// =============================================================================\n\n\nimport {HTMLBaseView} from './elements';\n\ntype CustomElementOptions = {template?: string};\ntype CustomElementConstructor = new (el: CustomHTMLElement) => CustomElementView;\n\n\n// -----------------------------------------------------------------------------\n// Utility Functions\n\nfunction applyTemplate(el: CustomHTMLElement, template: string) {\n  // Array.from() is required to break the reference to the original parent.\n  const children = Array.from(el.childNodes) as Element[];\n\n  el.innerHTML = template;\n\n  const slots: Record<string, HTMLElement> = {};\n  for (const s of Array.from(el.querySelectorAll('slot'))) {\n    slots[s.getAttribute('name') || ''] = s;\n  }\n\n  for (const child of children) {\n    const name = child.getAttribute ? (child.getAttribute('slot') || '') : '';\n    const slot = slots[name] || slots[''];\n    if (slot) slot.parentNode!.insertBefore(child, slot);\n  }\n\n  for (const slot of Object.values(slots)) slot.parentNode!.removeChild(slot);\n}\n\nfunction* customElementChildren(el: Element): Iterable<CustomHTMLElement> {\n  for (const c of Array.from(el.children)) {\n    if (c.tagName.includes('-')) {\n      yield c as CustomHTMLElement;\n    } else {\n      yield* customElementChildren(c);\n    }\n  }\n}\n\n\n// -----------------------------------------------------------------------------\n// Custom Element Classes\n\nconst customElementOptions = new Map<string, CustomElementOptions>();\n\nabstract class CustomHTMLElement extends HTMLElement {\n  private wasConnected = false;\n  private isReady = false;\n  _view!: CustomElementView;\n\n  async connectedCallback() {\n    // The element setup is done when it is first attached to the dom. We have\n    // to guard against this running more than once.\n    if (this.wasConnected) {\n      // TODO Bind the model of the new parent.\n      this._view.trigger('connected');\n      return;\n    }\n    this.wasConnected = true;\n    this.isReady = false;\n\n    this._view.created();\n\n    const options = customElementOptions.get(this._view.tagName) || {};\n\n    // Bind Component Template\n    if (options.template) applyTemplate(this, options.template);\n\n    // Select all unresolved custom element children\n    // TODO improve performance and fix ordering\n    const promises = [...customElementChildren(this)]\n      .filter(c => !c.isReady)\n      .map(c => new Promise(res => c.addEventListener('ready', res)));\n    setTimeout(() => {\n      if (!this.isReady) console.error(`Children of custom element ${this.tagName} not ready after 1s.`);\n    }, 1000);\n    await Promise.all(promises);\n\n    this._view.ready();\n    this.dispatchEvent(new CustomEvent('ready'));\n    this.isReady = true;\n  }\n\n  disconnectedCallback() {\n    this._view.trigger('disconnected');\n  }\n}\n\n/**\n * Base class for custom HTML elements. In addition to other custom methods,\n * it can implement `created()` and `ready()` methods that are executed during\n * the element lifecycle.\n */\nexport abstract class CustomElementView extends HTMLBaseView<CustomHTMLElement> {\n  created() {\n    // abstract\n  }\n\n  ready() {\n    // abstract\n  }\n}\n\nexport const CUSTOM_ELEMENTS = new Map<string, CustomElementConstructor>();\n\n/**\n * Decorator for registering a new custom HTML element.\n */\nexport function register(tagName: string, options: CustomElementOptions = {}) {\n  return function(ElementClass: CustomElementConstructor) {\n    if (window.customElements.get(tagName)) {\n      console.warn(`Trying to declare the custom element ${tagName} twice!`);\n      return;\n    }\n\n    // Every class can only be used once as custom element,\n    // so we have to make a copy.\n    class Constructor extends CustomHTMLElement {\n      constructor() {\n        super();\n        this._view = new ElementClass(this);\n      }\n    }\n\n    CUSTOM_ELEMENTS.set(tagName, ElementClass);\n    customElementOptions.set(tagName.toUpperCase(), options);\n    window.customElements.define(tagName, Constructor);\n  };\n}\n"],
  "mappings": "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",
  "names": ["throttle", "words", "Point", "_a", "style", "delay", "_a", "node", "length", "delay", "start", "end", "enter", "exit", "delay", "observer", "callback", "clear", "Point", "p", "_a", "style", "words", "_a", "Point", "observer", "delay", "SVGParentView", "InputView", "CanvasView", "throttle", "loop", "Point", "Point", "last", "_a", "EventTarget", "isReady", "EventTarget", "_a", "enter", "exit", "defer"]
}
